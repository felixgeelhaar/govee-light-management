const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./chunks/feedback-DiKmv6ah.js","./chunks/vue-vendor-CA8X9H5U.js","./chunks/xstate-vendor-C3sHgvBT.js","./feedback.css"])))=>i.map(i=>d[i]);
import{w as h,c as O,E as x,l as P,u as W,a as J,_ as z,i as H,A as Y}from"./chunks/propertyInspectorInit-ES-6d6Fn.js";import{q as Q,k as V,s as D,u as X,d as Z,b as I,m as ee,c,o as u,e as te,f as o,a as y,v as a,x as se,y as A,z as oe,A as U,t as L,B as ie,C as B,F as ne,r as ae,D as M,E as le,n as re,G as de}from"./chunks/vue-vendor-CA8X9H5U.js";import{_ as ce}from"./chunks/feedback-DiKmv6ah.js";import"./chunks/xstate-vendor-C3sHgvBT.js";function ue(C){const t=Q({settings:{...C},isLoading:!1,hasError:!1,error:null,hasChanges:!1,lastSaved:null}),r=V({...C}),l=async()=>{if(!h.isConnected){const n=O("Cannot load settings: WebSocket not connected",x.WEBSOCKET_CONNECTION_FAILED);P(n);return}t.isLoading=!0,t.hasError=!1,t.error=null;try{const n=h.getCurrentSettings();if(n){const g=n;Object.assign(t.settings,{...C,...g}),r.value={...t.settings},t.hasChanges=!1,t.lastSaved=new Date,console.log("Settings loaded successfully:",t.settings)}else console.log("No existing settings found, using defaults")}catch(n){const g=O("Failed to load settings from Stream Deck",x.SYSTEM_ERROR,{originalError:n});P(g),t.hasError=!0,t.error="Failed to load settings"}finally{t.isLoading=!1}},d=async()=>{if(!h.isConnected){const n=O("Cannot save settings: WebSocket not connected",x.WEBSOCKET_CONNECTION_FAILED);P(n),t.hasError=!0,t.error="Not connected to Stream Deck";return}if(t.hasChanges){t.isLoading=!0,t.hasError=!1,t.error=null;try{h.sendSettings(t.settings),r.value={...t.settings},t.hasChanges=!1,t.lastSaved=new Date}catch(n){const g=O("Failed to save settings to Stream Deck",x.SYSTEM_ERROR,{originalError:n,settings:t.settings});P(g),t.hasError=!0,t.error="Failed to save settings"}finally{t.isLoading=!1}}},E=(n,g)=>{t.settings[n]=g,m()},b=n=>{Object.assign(t.settings,n),m()},_=()=>{t.settings={...r.value},t.hasChanges=!1,t.hasError=!1,t.error=null},T=()=>{Object.assign(t.settings,{...C}),m()},m=()=>{t.hasChanges=JSON.stringify(t.settings)!==JSON.stringify(r.value)};let p=null;const R=(n=1e3)=>{D(()=>t.hasChanges,g=>{g&&(p&&clearTimeout(p),p=setTimeout(()=>{d(),p=null},n))},{immediate:!1})},v=()=>{p&&(clearTimeout(p),p=null)},S=()=>t.settings?"apiKey"in t.settings&&t.settings.apiKey&&t.settings.apiKey.length<10?(t.hasError=!0,t.error="API key appears to be too short",!1):(t.hasError=!1,t.error=null,!0):(t.hasError=!0,t.error="Settings object is required",!1),N=async()=>S()?(await d(),!t.hasError):!1,k=n=>{const g={...t.settings,...n};t.settings=g,r.value={...g},t.hasChanges=!1,t.lastSaved=new Date},w=()=>JSON.stringify(t.settings,null,2),F=n=>{try{const g=JSON.parse(n),K=Object.keys(C),$=Object.keys(g);return K.some(e=>$.includes(e))?(Object.assign(t.settings,{...C,...g}),m(),!0):(t.hasError=!0,t.error="Invalid settings format",!1)}catch(g){const K=O("Failed to import settings",x.INVALID_INPUT,{originalError:g,settingsJson:n});return P(K),t.hasError=!0,t.error="Invalid JSON format",!1}},f=n=>{n.event==="didReceiveSettings"&&n.payload?.settings&&k(n.payload.settings)};return D(()=>h.isConnected,n=>{n?(h.on("didReceiveSettings",f),X(()=>{h.requestSettings(),l()})):h.off("didReceiveSettings",f)},{immediate:!0}),{settings:t.settings,isLoading:t.isLoading,hasError:t.hasError,error:t.error,hasChanges:t.hasChanges,lastSaved:t.lastSaved,loadSettings:l,saveSettings:d,updateSetting:E,updateSettings:b,resetSettings:_,resetToDefaults:T,enableAutoSave:R,disableAutoSave:v,validateSettings:S,saveWithValidation:N,handleIncomingSettings:k,exportSettings:w,importSettings:F,isValid:()=>!t.hasError&&S(),isDirty:()=>t.hasChanges,canSave:()=>t.hasChanges&&!t.isLoading&&h.isConnected}}function ge(){return ue({apiKey:void 0,selectedDeviceId:void 0,selectedModel:void 0,selectedLightName:void 0,controlMode:"toggle",brightnessValue:100,colorValue:"#ffffff",colorTempValue:6500})}const ve={class:"light-control-view",role:"main","aria-labelledby":"main-heading"},pe={class:"config-section","data-testid":"api-key-section",role:"region","aria-labelledby":"api-config-heading"},he={class:"form-group"},fe={class:"input-group"},me=["type","disabled"],ye=["aria-label","aria-pressed"],be={"aria-hidden":"true"},Se=["disabled","aria-describedby"],Ce={key:0},_e={key:1},ke={key:2,id:"connecting-status",class:"sr-only"},Le={key:3,id:"api-connected-status",class:"sr-only"},Ee={class:"config-section","data-testid":"light-selection-section",role:"region","aria-labelledby":"light-selection-heading"},Te={key:0,class:"form-group"},Ie=["disabled"],Ae={key:1,class:"form-group"},Ve={class:"form-group"},De=["disabled"],Ne={value:"",disabled:""},we=["value"],Ke={key:0,class:"search-section"},Oe={class:"button-group"},xe=["disabled"],Pe={key:0},Fe={key:1},Me=["disabled"],Re={key:0},$e={key:1},Ue={class:"config-section","data-testid":"control-mode-section",role:"region","aria-labelledby":"control-mode-heading"},Be={class:"form-group"},je={key:0,class:"form-group"},Ge=["aria-valuetext"],qe={id:"brightness-value-display",class:"range-value",role:"status","aria-live":"polite"},We={key:1,class:"form-group"},Je={key:2,class:"form-group"},ze=["aria-valuetext"],He={class:"range-feedback-group"},Ye={id:"colortemp-value-display",class:"range-value",role:"status","aria-live":"polite"},Qe={id:"colortemp-description",class:"range-description"},Xe=["aria-live","aria-label"],Ze={class:"status-icon","aria-hidden":"true"},et={class:"status-text"},tt=Z({__name:"LightControlView",setup(C){const t=se(()=>z(()=>import("./chunks/feedback-DiKmv6ah.js").then(s=>s.a),__vite__mapDeps([0,1,2,3]),import.meta.url)),r=W(),l=J(),d=ge(),E=V(""),b=V(!1),_=V(!1),T=V(),m=V(""),p=V("info"),R=I(()=>({info:"ℹ️",success:"✅",error:"❌",warning:"⚠️"})[p.value]),v=(s,e="info",i=3e3)=>{m.value=s,p.value=e,T.value&&(T.value.textContent=s),i>0&&setTimeout(()=>{m.value="",T.value&&(T.value.textContent="")},i)},S=I({get:()=>d.settings.apiKey||"",set:s=>d.updateSetting("apiKey",s||void 0)}),N=I({get:()=>{const s=d.settings.selectedDeviceId,e=d.settings.selectedModel;return s&&e?`${s}|${e}`:""},set:s=>{if(s){const[e,i]=s.split("|"),G=l.filteredLights.value.find(q=>q.value===s)?.label;d.updateSettings({selectedDeviceId:e,selectedModel:i,selectedLightName:G})}else d.updateSettings({selectedDeviceId:void 0,selectedModel:void 0,selectedLightName:void 0})}}),k=I({get:()=>d.settings.controlMode||"toggle",set:s=>d.updateSetting("controlMode",s)}),w=I({get:()=>d.settings.brightnessValue||100,set:s=>d.updateSetting("brightnessValue",s)}),F=I({get:()=>d.settings.colorValue||"#ffffff",set:s=>d.updateSetting("colorValue",s)}),f=I({get:()=>d.settings.colorTempValue||6500,set:s=>d.updateSetting("colorTempValue",s)}),n=()=>{S.value&&(v("Validating API key...","info"),r.connect(S.value))},g=()=>{E.value="",l.clearSearch()},K=()=>{v("Refreshing lights...","info"),l.refreshLights()},$=async()=>{if(!N.value){v("Please select a light to test","warning");return}b.value=!0;try{v("Testing light...","info",0),await h.sendToPlugin({event:"testLight"}),setTimeout(()=>{b.value&&(console.warn("Test light timeout reached, resetting state"),b.value=!1,v("Test timeout - light may have still blinked","warning"))},5e3)}catch(s){console.error("Failed to send test light command:",s),b.value=!1,v("Failed to send test command","error")}};return D(()=>r.isConnected.value,(s,e)=>{s&&!e&&(v("API connected successfully","success"),l.isIdle.value&&l.fetchLights())}),D(()=>r.error.value,s=>{s&&v(`API connection failed: ${s}`,"error")}),D(()=>l.state.value,(s,e)=>{if(s==="fetching"&&e==="idle")v("Discovering lights...","info",0);else if(s==="success"&&e==="fetching"){const i=l.lights.value.length;i>0?v(`Found ${i} light${i!==1?"s":""}`,"success"):v("No lights found - check connections","warning")}else s==="error"&&v("Light discovery failed","error")}),D(()=>l.error.value,s=>{s&&v(`Discovery error: ${s}`,"error")}),D(()=>d.lastSaved,s=>{s&&v("Settings saved","success")}),ee(()=>{d.enableAutoSave(500);const s=()=>{h.isConnected?(d.loadSettings(),h.on("sendToPropertyInspector",e=>{e.payload?.event==="testResult"&&(b.value=!1,e.payload.success?v(e.payload.message||"Light blinked successfully!","success"):v(e.payload.message||"Failed to control the light","error"))})):setTimeout(s,100)};s()}),(s,e)=>(u(),c("main",ve,[te(a(t)),e[24]||(e[24]=o("h1",{id:"main-heading",class:"sr-only"},"Govee Light Control Configuration",-1)),o("section",pe,[e[14]||(e[14]=o("h2",{id:"api-config-heading"},"API Configuration",-1)),o("div",he,[e[12]||(e[12]=o("label",{for:"apiKey"},"API Key",-1)),o("div",fe,[A(o("input",{id:"apiKey","onUpdate:modelValue":e[0]||(e[0]=i=>S.value=i),type:_.value?"text":"password",class:"form-input",placeholder:"Enter your Govee API key",autocomplete:"off",disabled:a(r).isConnecting.value,onKeyup:U(n,["enter"])},null,40,me),[[oe,S.value]]),o("button",{type:"button",class:"btn btn-icon",onClick:e[1]||(e[1]=i=>_.value=!_.value),"aria-label":_.value?"Hide API key":"Show API key","aria-pressed":_.value,role:"switch"},[o("span",be,L(_.value?"🙈":"👁️"),1)],8,ye),a(r).isDisconnected.value||a(r).hasError.value?(u(),c("button",{key:0,class:"btn btn-primary",disabled:!S.value||a(r).isConnecting.value,"aria-describedby":a(r).isConnecting.value?"connecting-status":void 0,onClick:n},[a(r).isConnecting.value?(u(),c("span",Ce,e[11]||(e[11]=[o("span",{class:"spinner","aria-hidden":"true"},null,-1),ie(" Connecting... ",-1)]))):(u(),c("span",_e,"Connect"))],8,Se)):a(r).isConnected.value?(u(),c("button",{key:1,class:"btn btn-secondary",onClick:e[2]||(e[2]=(...i)=>a(r).disconnect&&a(r).disconnect(...i)),"aria-describedby":"api-connected-status"}," Disconnect ")):y("",!0),a(r).isConnecting.value?(u(),c("div",ke," Attempting to connect to Govee API, please wait ")):y("",!0),a(r).isConnected.value?(u(),c("div",Le," Successfully connected to Govee API ")):y("",!0)]),e[13]||(e[13]=o("small",{class:"help-text"}," Get your API key from the Govee Home app → Settings → About Us → Apply for API Key ",-1))])]),o("section",Ee,[e[17]||(e[17]=o("h2",{id:"light-selection-heading"},"Light Selection",-1)),a(l).isIdle.value?(u(),c("div",Te,[o("button",{class:"btn btn-primary",disabled:!a(r).isConnected.value,onClick:e[3]||(e[3]=(...i)=>a(l).fetchLights&&a(l).fetchLights(...i))}," Discover Lights ",8,Ie),e[15]||(e[15]=o("small",{class:"help-text"}," Connect your API key first, then discover available lights ",-1))])):a(l).isReady.value?(u(),c("div",Ae,[o("div",Ve,[e[16]||(e[16]=o("label",{for:"lightSelect"},"Light",-1)),A(o("select",{id:"lightSelect","onUpdate:modelValue":e[4]||(e[4]=i=>N.value=i),class:"form-select",disabled:!a(l).hasFilteredLights.value},[o("option",Ne,L(a(l).hasFilteredLights.value?"Select a light...":"No lights found"),1),(u(!0),c(ne,null,ae(a(l).filteredLights.value,i=>(u(),c("option",{key:i.value,value:i.value},L(i.label),9,we))),128))],8,De),[[B,N.value]]),a(l).hasFilteredLights.value?(u(),c("div",Ke,[A(o("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>E.value=i),type:"text",class:"form-input search-input",placeholder:"Search lights...",onInput:e[6]||(e[6]=i=>a(l).searchLights(E.value)),onKeydown:U(g,["escape"])},null,544),[[M,E.value]]),E.value?(u(),c("button",{key:0,class:"btn-clear",onClick:g,type:"button"}," ✕ ")):y("",!0)])):y("",!0)]),o("div",Oe,[o("button",{class:"btn btn-secondary",onClick:K,disabled:a(l).isFetchingLights.value},[a(l).isFetchingLights.value?(u(),c("span",Pe,"Refreshing...")):(u(),c("span",Fe,"🔄 Refresh Lights"))],8,xe),o("button",{class:"btn btn-accent",onClick:$,disabled:!N.value||b.value},[b.value?(u(),c("span",Re,"Testing...")):(u(),c("span",$e,"💡 Test Light"))],8,Me)])])):y("",!0)]),o("section",Ue,[e[23]||(e[23]=o("h2",{id:"control-mode-heading"},"Control Mode",-1)),o("div",Be,[e[19]||(e[19]=o("label",{for:"controlMode"},"Control Mode",-1)),A(o("select",{id:"controlMode","onUpdate:modelValue":e[7]||(e[7]=i=>k.value=i),class:"form-select"},e[18]||(e[18]=[le('<option value="toggle" data-v-8f49e222>Toggle On/Off</option><option value="on" data-v-8f49e222>Turn On</option><option value="off" data-v-8f49e222>Turn Off</option><option value="brightness" data-v-8f49e222>Set Brightness</option><option value="color" data-v-8f49e222>Set Color</option><option value="colorTemp" data-v-8f49e222>Set Color Temperature</option>',6)]),512),[[B,k.value]])]),k.value==="brightness"?(u(),c("div",je,[e[20]||(e[20]=o("label",{for:"brightness"},"Brightness (%)",-1)),A(o("input",{id:"brightness","onUpdate:modelValue":e[8]||(e[8]=i=>w.value=i),type:"range",min:"1",max:"100",step:"1",class:"form-range","aria-valuetext":`${w.value} percent brightness`,"aria-describedby":"brightness-value-display"},null,8,Ge),[[M,w.value,void 0,{number:!0}]]),o("span",qe,L(w.value)+"%",1)])):y("",!0),k.value==="color"?(u(),c("div",We,[e[21]||(e[21]=o("label",{for:"color"},"Color",-1)),A(o("input",{id:"color","onUpdate:modelValue":e[9]||(e[9]=i=>F.value=i),type:"color",class:"form-color"},null,512),[[M,F.value]])])):y("",!0),k.value==="colorTemp"?(u(),c("div",Je,[e[22]||(e[22]=o("label",{for:"colorTemp"},"Color Temperature (K)",-1)),A(o("input",{id:"colorTemp","onUpdate:modelValue":e[10]||(e[10]=i=>f.value=i),type:"range",min:"2000",max:"9000",step:"100",class:"form-range","aria-valuetext":`${f.value} Kelvin, ${f.value<4e3?"warm":f.value>6e3?"cool":"neutral"} white light`,"aria-describedby":"colortemp-value-display colortemp-description"},null,8,ze),[[M,f.value,void 0,{number:!0}]]),o("div",He,[o("span",Ye,L(f.value)+"K",1),o("span",Qe,L(f.value<4e3?"Warm":f.value>6e3?"Cool":"Neutral"),1)])])):y("",!0)]),m.value?(u(),c("div",{key:0,class:re(["status-field",p.value]),role:"status","aria-live":p.value==="error"?"assertive":"polite","aria-atomic":"true","aria-label":`Status update: ${m.value}`},[o("span",Ze,L(R.value),1),o("span",et,L(m.value),1)],10,Xe)):y("",!0),o("div",{class:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true",ref_key:"screenReaderStatus",ref:T},null,512)]))}}),st=ce(tt,[["__scopeId","data-v-8f49e222"]]);H();const j=de(Y);j.component("main-view",st);j.mount("#app");
