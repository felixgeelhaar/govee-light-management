import{u as B,_ as N,F as Y}from"./feedback-DiKmv6ah.js";import{w as m,a as M,u as q}from"./propertyInspectorInit-ES-6d6Fn.js";import{d as x,k as A,b as K,m as V,c as r,o as d,f as e,e as F,a as S,n as D,B as R,t as C,T as J,i as W,y as j,z as O,s as G,v as y,F as Q,r as X,J as E}from"./vue-vendor-CA8X9H5U.js";const Z={class:"api-key-section"},ee={class:"status-header"},te={class:"status-info"},se=["title"],ne={key:0,class:"status-message"},oe={key:0,class:"api-config-expanded"},ie={class:"form-group"},ae={class:"api-key-container"},le=["type"],ce=["title"],re={class:"api-action-buttons"},de=["disabled"],ue=["disabled"],he=x({__name:"ApiKeyConfiguration",props:{connection:{}},emits:["api-key-changed","api-key-saved","testing-connection"],setup($,{emit:P}){const u=$,k=P,t=B(),l=A(!1),v=A(!1),i=A(""),h=A(""),_=A(!1),b=A(!1),T=A(!1);let L=null,w=null;const c=K(()=>u.connection.isConnected),n=K(()=>v.value?u.connection.isConnected?"connected":u.connection.isConnecting?"connecting":u.connection.hasError?"error":"disconnected":"disconnected"),g=K(()=>v.value?u.connection.isConnected?"Connected":u.connection.isConnecting?"Connecting...":u.connection.hasError?"Connection Failed":"Disconnected":"Not Configured"),s=()=>{k("api-key-changed",i.value)},a=async()=>{const p=i.value.trim();if(!(!p||T.value)){T.value=!0;try{await m.sendToPlugin({event:"setGlobalApiKey",apiKey:p}),h.value=p,v.value=!0,t.showSuccess("API Key Saved","Your API key has been saved successfully"),k("api-key-saved",p),u.connection.isConnected||u.connection.connect(p),setTimeout(()=>{l.value=!1},1500)}catch{t.showError("Save Failed","Failed to save API key. Please try again.")}finally{T.value=!1}}},f=async()=>{const p=i.value.trim();if(!(!p||b.value)){b.value=!0,w=Date.now(),k("testing-connection",!0);try{t.dismissCategory("api-connection"),L=t.showApiConnectionTesting(),await m.sendToPlugin({event:"testApiConnection",apiKey:p})}catch(o){console.error("Error in testConnection:",o),t.showError("Connection Test Failed","Failed to send test request. Please try again.","api-connection"),b.value=!1,L=null,w=null,k("testing-connection",!1)}}},H=async()=>{if(confirm("Are you sure you want to clear the API key?"))try{await m.sendToPlugin({event:"clearGlobalApiKey"}),i.value="",h.value="",v.value=!1,t.showInfo("API Key Cleared","Your API key has been removed"),k("api-key-changed","")}catch{t.showError("Clear Failed","Failed to clear API key. Please try again.")}},U=async()=>{try{await m.sendToPlugin({event:"getGlobalApiKey"})}catch(p){console.error("Failed to load API key:",p)}};return V(()=>{const p=()=>{m.isConnected?(U(),m.on("sendToPropertyInspector",o=>{if(o.payload?.event==="globalApiKey"){const I=o.payload.apiKey;I&&(i.value=I,h.value=I,v.value=!0,u.connection.isConnected||u.connection.connect(I))}if(o.payload?.event==="globalApiKeySaved"&&(o.payload.success||t.showError("Save Failed",o.payload.error||"Failed to save API key"),T.value=!1),o.payload?.event==="apiConnectionTested"){const I=w?Date.now()-w:0,z=Math.max(0,1500-I);setTimeout(()=>{b.value=!1,k("testing-connection",!1),L?(o.payload.success?t.updateToast(L,{type:"success",title:"Test Successful",message:o.payload.message||"API key validated successfully!",duration:5e3}):t.updateToast(L,{type:"error",title:"Connection Failed",message:o.payload.error||"Failed to connect to the Govee API. Please check your API key and try again.",duration:8e3}),L=null,w=null):(console.warn("ApiKeyConfiguration: Test toast ID was lost, showing new toast"),o.payload.success?t.showApiConnectionSuccess(o.payload.message||"API key validated successfully!"):t.showApiConnectionError(o.payload.error||"Failed to connect to the Govee API. Please check your API key and try again."),w=null)},z)}})):setTimeout(p,100)};p()}),(p,o)=>(d(),r("section",Z,[e("div",{class:D(["api-status-card",{connected:c.value}])},[e("div",ee,[e("div",te,[o[4]||(o[4]=e("span",{class:"status-label"},"API Connection",-1)),e("span",{class:D(["status-indicator",n.value])},[o[3]||(o[3]=e("span",{class:"status-dot"},null,-1)),R(" "+C(g.value),1)],2)]),e("button",{onClick:o[0]||(o[0]=I=>l.value=!l.value),class:"edit-button",type:"button",title:l.value?"Hide API Configuration":"Edit API Configuration"},C(l.value?"‚úï":"‚úèÔ∏è"),9,se)]),!v.value&&!l.value?(d(),r("div",ne,o[5]||(o[5]=[e("small",{class:"help-text"}," Click the edit button to configure your Govee API key ",-1)]))):S("",!0)],2),F(J,{name:"expand"},{default:W(()=>[l.value?(d(),r("div",oe,[e("div",ie,[o[6]||(o[6]=e("label",{for:"apiKey"},"Govee API Key",-1)),e("div",ae,[j(e("input",{type:_.value?"text":"password",id:"apiKey","onUpdate:modelValue":o[1]||(o[1]=I=>i.value=I),onInput:s,placeholder:"Enter your Govee API key",class:"form-input",autocomplete:"off"},null,40,le),[[O,i.value]]),e("button",{onClick:o[2]||(o[2]=I=>_.value=!_.value),class:"password-toggle",type:"button",title:_.value?"Hide API Key":"Show API Key"},C(_.value?"üôà":"üëÅÔ∏è"),9,ce)]),o[7]||(o[7]=e("small",{class:"help-text"}," Get your API key from: Govee Home app ‚Üí Settings ‚Üí About Us ‚Üí Apply for API Key ",-1)),e("div",re,[e("button",{onClick:f,class:"btn btn-secondary btn-small",disabled:!i.value||b.value},C(b.value?"Testing...":"üîå Test Connection"),9,de),i.value&&i.value!==h.value?(d(),r("button",{key:0,onClick:a,class:"btn btn-primary btn-small",disabled:T.value},C(T.value?"Saving...":"üíæ Save"),9,ue)):S("",!0),v.value?(d(),r("button",{key:1,onClick:H,class:"btn btn-danger btn-small"}," üóëÔ∏è Clear ")):S("",!0)])])])):S("",!0)]),_:1})]))}}),ge=N(he,[["__scopeId","data-v-4571e45d"]]),ve={class:"config-section"},ye={class:"form-group"},pe={key:0,class:"state-message"},fe={key:1,class:"state-message"},me={class:"discovery-actions"},be=["disabled"],Ce={key:0,class:"loading-spinner-sm"},ke={key:2,class:"state-message"},Ae={key:3,class:"selection-state"},_e=["value","disabled"],Te={value:"",disabled:""},Le=["value"],we={class:"button-group"},Ie=["disabled"],Se={key:0},Pe={key:1},Ke=["disabled"],$e={key:0},Fe={key:1},De={key:0,class:"light-count"},Ee={key:4,class:"state-message error-state"},Ge=x({__name:"LightSelector",props:{hasApiKey:{type:Boolean},selectedLight:{}},emits:["update:selectedLight","lightSelected"],setup($,{emit:P}){const u=$,k=P,t=M(),l=B(),v=A(!1),i=A(!1),h=K(()=>u.selectedLight?t.filteredLights.value.find(c=>c.value===u.selectedLight):null),_=async()=>{v.value=!0;try{l.showLightDiscovery(),await t.fetchLights()}finally{v.value=!1}},b=()=>{l.showInfo("Refreshing Lights","Discovering available devices...","light-discovery"),t.refreshLights()},T=()=>{t.retryFetch()},L=c=>{const n=c.target.value;if(k("update:selectedLight",n),n){const[g,s]=n.split("|"),a=h.value?.label||"Unknown Light";k("lightSelected",g,s,a)}},w=async()=>{if(!u.selectedLight||i.value)return;const[c,n]=u.selectedLight.split("|");if(!c||!n){l.showError("Invalid Light Selection","Please select a valid light from the list","light-test");return}const g=h.value?.label;i.value=!0;let s=null;try{l.dismissCategory("light-test"),s=l.showLightTestStart(g),await m.sendToPlugin({event:"testLight",deviceId:c,model:n}),setTimeout(()=>{i.value&&(i.value=!1,s&&l.updateToast(s,{type:"warning",title:"Test Timeout",message:"Light test timed out, but light may have still blinked",duration:3e3}))},5e3)}catch{i.value=!1,l.showLightTestError("Failed to send test command",g)}};return G(()=>t.state.value,(c,n)=>{if(c==="fetching"&&n==="idle")l.showLightDiscovery();else if(c==="success"&&n==="fetching"){const g=t.lights.value.length;l.showLightDiscoverySuccess(g)}else c==="error"&&l.showLightDiscoveryError("Failed to discover lights")}),m.on("sendToPropertyInspector",c=>{if(c.payload?.event==="testResult"){i.value=!1;const n=h.value?.label;c.payload.success?l.showLightTestSuccess(n):l.showLightTestError(c.payload.message||"Failed to control the light",n)}}),(c,n)=>(d(),r("section",ve,[n[7]||(n[7]=e("h2",null,"Light Selection",-1)),e("div",ye,[n[6]||(n[6]=e("label",{for:"lightSelect"},"Select Light",-1)),c.hasApiKey?y(t).isIdle.value?(d(),r("div",fe,[e("div",me,[e("button",{class:"btn btn-primary btn-discover",onClick:_,disabled:v.value},[v.value?(d(),r("span",Ce)):S("",!0),R(" "+C(v.value?"Discovering...":"üîç Discover Lights"),1)],8,be),n[2]||(n[2]=e("p",{class:"help-text"},"Find your Govee lights on the network",-1))])])):y(t).isFetchingLights.value?(d(),r("div",ke,n[3]||(n[3]=[e("div",{class:"loading-state"},[e("div",{class:"loading-spinner-sm"}),e("p",{class:"loading-text"},"Searching for lights...")],-1)]))):y(t).isReady.value?(d(),r("div",Ae,[e("select",{id:"lightSelect",value:c.selectedLight,onInput:n[0]||(n[0]=g=>L(g)),class:D(["form-select",{"has-selection":c.selectedLight}]),disabled:!y(t).hasFilteredLights.value},[e("option",Te,C(y(t).hasFilteredLights.value?"Select a light...":"No lights found"),1),(d(!0),r(Q,null,X(y(t).filteredLights.value,g=>(d(),r("option",{key:g.value,value:g.value},C(g.label),9,Le))),128))],42,_e),e("div",we,[e("button",{class:"btn btn-secondary btn-small",onClick:b,disabled:y(t).isFetchingLights.value,title:"Refresh light list"},[y(t).isFetchingLights.value?(d(),r("span",Se,"Refreshing...")):(d(),r("span",Pe,"üîÑ Refresh"))],8,Ie),c.selectedLight?(d(),r("button",{key:0,class:"btn btn-accent btn-small",onClick:w,disabled:i.value,title:"Test selected light"},[i.value?(d(),r("span",$e,"Testing...")):(d(),r("span",Fe,"üí° Test Light"))],8,Ke)):S("",!0)]),y(t).lights.value.length>0?(d(),r("div",De," Found "+C(y(t).lights.value.length)+" light"+C(y(t).lights.value.length!==1?"s":""),1)):S("",!0)])):y(t).hasError.value?(d(),r("div",Ee,[n[4]||(n[4]=e("div",{class:"state-icon error"},"‚ö†Ô∏è",-1)),n[5]||(n[5]=e("p",{class:"error-text"},"Failed to discover lights",-1)),e("button",{class:"btn btn-secondary btn-small",onClick:T}," Try Again ")])):S("",!0):(d(),r("div",pe,n[1]||(n[1]=[e("div",{class:"state-icon"},"üîë",-1),e("p",{class:"help-text"},"Configure API key first to discover lights",-1)])))])]))}}),Be=N(Ge,[["__scopeId","data-v-f96376c1"]]),Ne={class:"config-section"},xe={key:0,class:"config-section summary-section"},Re={class:"summary-card"},Me={class:"summary-item"},Ve={class:"summary-value"},He={class:"summary-item"},Ue={class:"summary-value"},ze={key:1,class:"config-section help-section"},Ye={class:"help-details"},qe={class:"help-content"},Je=x({__name:"BaseActionView",props:{actionType:{},configTitle:{},actionSummary:{default:"Control Light"},showSummary:{type:Boolean,default:!0},showHelp:{type:Boolean,default:!0}},emits:["settings-changed","light-selected"],setup($,{expose:P,emit:u}){const k=u,t=q(),l=M(),v=B(),i=A(!1),h=A(""),_=A(!1),b=K(()=>h.value?l.filteredLights.value.find(s=>s.value===h.value):null),T=s=>{i.value=!!s},L=s=>{i.value=!!s,s&&!t.isConnected.value&&t.connect(s)},w=s=>{_.value=s},c=(s,a,f)=>{k("light-selected",s,a,f)},n=s=>{k("settings-changed",s),m.sendToPlugin({event:"setSettings",settings:s})},g=()=>{m.sendToPlugin({event:"getSettings"})};return G(()=>t.isConnected.value,(s,a)=>{s&&!a&&!_.value&&(v.showApiConnectionSuccess("Connected to Govee API successfully"),l.isIdle.value&&l.fetchLights())}),G(()=>t.error.value,s=>{s&&v.showApiConnectionError(s)}),V(()=>{const s=()=>{m.isConnected?(m.sendToPlugin({event:"getGlobalApiKey"}),g(),m.on("sendToPropertyInspector",a=>{if(a.payload?.event==="globalApiKey"){const f=a.payload.apiKey;i.value=!!f,f&&!t.isConnected.value&&t.connect(f)}if(a.payload?.event==="currentSettings"){const f=a.payload.settings;f.lightId&&f.lightModel&&(h.value=`${f.lightId}|${f.lightModel}`),i.value&&!t.isConnected.value&&m.sendToPlugin({event:"getGlobalApiKey"})}})):setTimeout(s,100)};s()}),P({saveSettings:n,loadSettings:g,selectedLight:h,selectedLightInfo:b,hasApiKey:i}),(s,a)=>(d(),r("div",{class:D(`${s.actionType}-action-view action-view`)},[F(Y),F(ge,{connection:{isConnected:y(t).isConnected.value,isConnecting:y(t).isConnecting.value,hasError:y(t).hasError.value,connect:y(t).connect},onApiKeyChanged:T,onApiKeySaved:L,onTestingConnection:w},null,8,["connection"]),F(Be,{"has-api-key":i.value,"selected-light":h.value,"onUpdate:selectedLight":a[0]||(a[0]=f=>h.value=f),onLightSelected:c},null,8,["has-api-key","selected-light"]),e("section",Ne,[e("h2",null,C(s.configTitle),1),E(s.$slots,"action-config",{selectedLight:h.value,lightInfo:b.value},void 0)]),s.showSummary&&i.value&&h.value?(d(),r("section",xe,[a[3]||(a[3]=e("h2",null,"Action Summary",-1)),e("div",Re,[e("div",Me,[a[1]||(a[1]=e("span",{class:"summary-label"},"Light:",-1)),e("span",Ve,C(b.value?.label||"Unknown"),1)]),e("div",He,[a[2]||(a[2]=e("span",{class:"summary-label"},"Action:",-1)),e("span",Ue,C(s.actionSummary),1)]),E(s.$slots,"summary-items",{selectedLight:h.value,lightInfo:b.value},void 0)])])):S("",!0),s.showHelp?(d(),r("section",ze,[e("details",Ye,[a[5]||(a[5]=e("summary",{class:"help-summary"},[e("span",{class:"help-icon"},"‚ùì"),R(" Need help? ")],-1)),e("div",qe,[E(s.$slots,"help-content",{},()=>[a[4]||(a[4]=e("p",null,"This action will control your selected Govee light when you press the Stream Deck button.",-1))])])])])):S("",!0)],2))}}),Xe=N(Je,[["__scopeId","data-v-4e0e3b7a"]]);export{Xe as B};
