import{y as X,z as y,B as K,C as f,r as L,c as g,o as q,D as Y,E as Z,d as j,u as ee,a as te,G as oe,w as H,e as p,f as c,g as r,h as C,j as k,v as D,k as se,l as n,m as E,t as m,n as B,F as W,p as $,q as re,_ as ne,s as ae,x as ie,A as le}from"./propertyInspectorInit.js";const ue=X({actions:{setGroups:y({groups:({event:t})=>t.type==="GROUPS_LOADED"?t.groups:[]}),setCurrentGroup:y({currentGroup:({event:t})=>t.type==="EDIT_GROUP"?t.group:null}),clearCurrentGroup:y({currentGroup:null,selectedLights:[]}),selectLight:y({selectedLights:({context:t,event:o})=>o.type==="SELECT_LIGHT"&&!t.selectedLights.includes(o.lightId)?[...t.selectedLights,o.lightId]:t.selectedLights}),deselectLight:y({selectedLights:({context:t,event:o})=>o.type==="DESELECT_LIGHT"?t.selectedLights.filter(a=>a!==o.lightId):t.selectedLights}),addOrUpdateGroup:y({groups:({context:t,event:o})=>{if(o.type==="GROUP_SAVED"){const a=t.groups.findIndex(s=>s.id===o.group.id);if(a>=0){const s=[...t.groups];return s[a]=o.group,s}else return[...t.groups,o.group]}return t.groups}}),removeGroup:y({groups:({context:t,event:o})=>o.type==="GROUP_DELETED"?t.groups.filter(a=>a.id!==o.groupId):t.groups}),setError:y({error:({event:t})=>t.type==="OPERATION_FAILED"?t.error:null}),clearError:y({error:null}),startLoading:y({isLoading:!0}),stopLoading:y({isLoading:!1})},actors:{loadGroups:K(async({input:t})=>{if(!f.isConnected)throw new Error("WebSocket not connected to Stream Deck");return new Promise((o,a)=>{const s=setTimeout(()=>{f.off("sendToPropertyInspector",l),a(new Error("Group loading timeout"))},1e4),l=d=>{d.payload?.event==="groupsReceived"&&(clearTimeout(s),f.off("sendToPropertyInspector",l),d.payload.error?a(new Error(d.payload.error)):o(d.payload.groups||[]))};f.on("sendToPropertyInspector",l),f.requestGroups()})}),saveGroup:K(async({input:t})=>{if(!f.isConnected)throw new Error("WebSocket not connected to Stream Deck");return new Promise((o,a)=>{const s=setTimeout(()=>{f.off("sendToPropertyInspector",l),a(new Error("Group save timeout"))},1e4),l=d=>{d.payload?.event==="groupSaved"&&(clearTimeout(s),f.off("sendToPropertyInspector",l),d.payload.error?a(new Error(d.payload.error)):o(d.payload.group))};f.on("sendToPropertyInspector",l),f.saveGroup({name:t.name,lightIds:t.selectedLights})})}),deleteGroup:K(async({input:t})=>{if(!f.isConnected)throw new Error("WebSocket not connected to Stream Deck");return new Promise((o,a)=>{const s=setTimeout(()=>{f.off("sendToPropertyInspector",l),a(new Error("Group delete timeout"))},1e4),l=d=>{d.payload?.event==="groupDeleted"&&(clearTimeout(s),f.off("sendToPropertyInspector",l),d.payload.error?a(new Error(d.payload.error)):o(d.payload.groupId))};f.on("sendToPropertyInspector",l),f.deleteGroup(t.groupId)})})}}).createMachine({id:"groupManagement",initial:"idle",context:({input:t})=>({groups:[],currentGroup:null,availableLights:[],selectedLights:[],error:null,isLoading:!1}),states:{idle:{on:{LOAD_GROUPS:{target:"loading"}}},loading:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"loadGroups",input:({self:t})=>t._parent?.input||{},onDone:{target:"ready",actions:y({groups:({event:t})=>t.output})},onError:{target:"error",actions:y({error:({event:t})=>t.error.message})}},on:{GROUPS_LOADED:{target:"ready",actions:"setGroups"},OPERATION_FAILED:{target:"error",actions:"setError"}}},ready:{on:{CREATE_GROUP:{target:"editing",actions:"clearCurrentGroup"},EDIT_GROUP:{target:"editing",actions:["setCurrentGroup",y({selectedLights:({event:t})=>t.type==="EDIT_GROUP"?t.group.lightIds:[]})]},DELETE_GROUP:{target:"deleting"},LOAD_GROUPS:{target:"loading"}}},editing:{on:{SAVE_GROUP:{target:"saving"},CANCEL_EDIT:{target:"ready",actions:"clearCurrentGroup"},SELECT_LIGHT:{actions:"selectLight"},DESELECT_LIGHT:{actions:"deselectLight"}}},saving:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"saveGroup",input:({context:t,event:o,self:a})=>{const s=a._parent?.input||{};return o.type==="SAVE_GROUP"?{...s,name:o.name,selectedLights:o.selectedLights,groupId:t.currentGroup?.id}:s},onDone:{target:"ready",actions:[y({groups:({context:t,event:o})=>{const a=o.output,s=t.groups.findIndex(l=>l.id===a.id);if(s>=0){const l=[...t.groups];return l[s]=a,l}else return[...t.groups,a]}}),"clearCurrentGroup"]},onError:{target:"error",actions:y({error:({event:t})=>t.error.message})}},on:{GROUP_SAVED:{target:"ready",actions:["addOrUpdateGroup","clearCurrentGroup"]},OPERATION_FAILED:{target:"error",actions:"setError"}}},deleting:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"deleteGroup",input:({event:t,self:o})=>{const a=o._parent?.input||{};return t.type==="DELETE_GROUP"?{...a,groupId:t.groupId}:a},onDone:{target:"ready",actions:y({groups:({context:t,event:o})=>t.groups.filter(a=>a.id!==o.output)})},onError:{target:"error",actions:y({error:({event:t})=>t.error.message})}},on:{GROUP_DELETED:{target:"ready",actions:"removeGroup"},OPERATION_FAILED:{target:"error",actions:"setError"}}},error:{on:{LOAD_GROUPS:{target:"loading",actions:"clearError"},CREATE_GROUP:{target:"editing",actions:["clearError","clearCurrentGroup"]}}}}});function de(){const t=L(null),o=L("idle"),a=L([]),s=L(null),l=L([]),d=L([]),P=L(null),h=L(!1),I=g(()=>o.value==="idle"),_=g(()=>o.value==="loading"),G=g(()=>o.value==="ready"),b=g(()=>o.value==="editing"),T=g(()=>o.value==="saving"),A=g(()=>o.value==="deleting"),S=g(()=>o.value==="error"),O=g(()=>a.value.length>0),R=g(()=>b.value&&s.value===null),U=g(()=>b.value&&s.value!==null);q(()=>{t.value=Y(ue,{}),t.value.subscribe(v=>{o.value=v.value,a.value=v.context.groups,s.value=v.context.currentGroup,l.value=v.context.availableLights,d.value=v.context.selectedLights,P.value=v.context.error,h.value=v.context.isLoading}),t.value.start()}),Z(()=>{t.value&&t.value.stop()});const w=()=>{t.value&&t.value.send({type:"LOAD_GROUPS"})},V=()=>{t.value&&t.value.send({type:"CREATE_GROUP"})},x=v=>{t.value&&t.value.send({type:"EDIT_GROUP",group:v})},N=(v,Q)=>{t.value&&t.value.send({type:"SAVE_GROUP",name:v,selectedLights:Q})},M=v=>{t.value&&t.value.send({type:"DELETE_GROUP",groupId:v})},u=()=>{t.value&&t.value.send({type:"CANCEL_EDIT"})},e=v=>{t.value&&t.value.send({type:"SELECT_LIGHT",lightId:v})},i=v=>{t.value&&t.value.send({type:"DESELECT_LIGHT",lightId:v})},F=v=>{d.value.includes(v)?i(v):e(v)},J=v=>g(()=>d.value.includes(v));return{state:g(()=>o.value),groups:g(()=>a.value),currentGroup:g(()=>s.value),availableLights:g(()=>l.value),selectedLights:g(()=>d.value),error:g(()=>P.value),isLoading:g(()=>h.value),isIdle:I,isLoadingGroups:_,isReady:G,isEditing:b,isSaving:T,isDeleting:A,hasError:S,hasGroups:O,isCreatingNew:R,isEditingExisting:U,loadGroups:w,createGroup:V,editGroup:x,saveGroup:N,deleteGroup:M,cancelEdit:u,selectLight:e,deselectLight:i,toggleLightSelection:F,isLightSelected:J}}const pe={class:"group-control-view"},ce={class:"config-section","data-testid":"api-key-section"},ge={class:"form-group"},ve={class:"input-group"},ye=["disabled"],fe=["disabled"],me={key:0},Ge={key:1},Ee={key:0,class:"status-message status-loading"},be={key:1,class:"status-message status-success"},Le={key:2,class:"status-message status-error"},he={class:"config-section","data-testid":"group-management-section"},_e={key:0,class:"form-group"},Ce=["disabled"],ke={key:1,class:"status-message status-loading"},Ie={key:2,class:"status-message status-error"},Te={key:3,class:"form-group"},Se={class:"form-group"},De=["disabled"],Pe={value:"",disabled:""},Ae=["value"],Oe={class:"group-actions"},Re=["disabled"],Ue=["disabled"],we={key:0},Ve={key:1},xe=["disabled"],Ne={key:0,class:"config-section","data-testid":"group-creation-form"},Me={key:0,class:"status-message status-loading"},Ke={key:1},Fe={class:"form-group"},He=["disabled"],Be={class:"form-group"},We={key:0,class:"status-message status-loading"},$e={key:1,class:"status-message status-loading"},qe={key:2,class:"status-message status-error"},ze={key:3,class:"light-selection"},Je=["id","checked","onChange"],Qe=["for"],Xe={key:4,class:"status-message status-error"},Ye={class:"form-actions"},Ze=["disabled"],je=["disabled"],et={class:"config-section","data-testid":"control-mode-section"},tt={class:"form-group"},ot={key:0,class:"form-group"},st={class:"range-value"},rt={key:1,class:"form-group"},nt={key:2,class:"form-group"},at={class:"range-value"},it=j({__name:"GroupControlView",setup(t){const o=ee(),a=te(),s=de(),l=oe(),d=L(""),P=g(()=>s.isCreatingNew.value),h=g(()=>s.isEditingExisting.value),I=g(()=>s.selectedLights.value),_=g({get:()=>l.settings.apiKey||"",set:u=>l.updateSetting("apiKey",u||void 0)}),G=g({get:()=>l.settings.selectedGroupId||"",set:u=>{if(l.updateSetting("selectedGroupId",u||void 0),u){const e=s.groups.value.find(i=>i.id===u);e&&l.updateSetting("selectedGroupName",e.name)}else l.updateSetting("selectedGroupName",void 0)}}),b=g({get:()=>l.settings.controlMode||"toggle",set:u=>l.updateSetting("controlMode",u)}),T=g({get:()=>l.settings.brightnessValue||100,set:u=>l.updateSetting("brightnessValue",u)}),A=g({get:()=>l.settings.colorValue||"#ffffff",set:u=>l.updateSetting("colorValue",u)}),S=g({get:()=>l.settings.colorTempValue||6500,set:u=>l.updateSetting("colorTempValue",u)}),O=()=>{_.value&&o.connect(_.value)},R=()=>{const u=s.groups.value.find(e=>e.id===G.value);u&&(s.editGroup(u),d.value=u.name)},U=()=>{G.value&&confirm("Are you sure you want to delete this group?")&&(s.deleteGroup(G.value),G.value="")},w=()=>{d.value&&I.value.length>0&&(s.saveGroup(d.value,I.value),d.value="")},V=()=>{s.cancelEdit(),d.value=""},x=()=>{s.createGroup(),d.value=""},N=u=>{s.toggleLightSelection(u)},M=u=>s.isLightSelected(u).value;return H(()=>o.isConnected.value,u=>{u&&(a.isIdle.value&&a.fetchLights(),s.isIdle.value&&s.loadGroups())}),H(()=>l.settings.apiKey,u=>{u&&!o.isConnected.value&&o.connect(u)}),q(()=>{l.enableAutoSave(500),l.loadSettings(),l.settings.apiKey&&o.connect(l.settings.apiKey),o.isConnected.value&&s.isIdle.value&&s.loadGroups()}),(u,e)=>(c(),p("div",pe,[r("section",ce,[e[17]||(e[17]=r("h2",null,"API Configuration",-1)),r("div",ge,[e[15]||(e[15]=r("label",{for:"apiKey"},"API Key",-1)),r("div",ve,[k(r("input",{id:"apiKey","onUpdate:modelValue":e[0]||(e[0]=i=>_.value=i),type:"password",class:"form-input",placeholder:"Enter your Govee API key",autocomplete:"off",disabled:n(o).isConnecting,onKeyup:se(O,["enter"])},null,40,ye),[[D,_.value]]),n(o).isDisconnected||n(o).hasError?(c(),p("button",{key:0,class:"btn btn-primary",disabled:!_.value||n(o).isConnecting,onClick:O},[n(o).isConnecting?(c(),p("span",me,"Connecting...")):(c(),p("span",Ge,"Connect"))],8,fe)):n(o).isConnected?(c(),p("button",{key:1,class:"btn btn-secondary",onClick:e[1]||(e[1]=(...i)=>n(o).disconnect&&n(o).disconnect(...i))}," Disconnect ")):C("",!0)]),n(o).isConnecting?(c(),p("div",Ee,e[12]||(e[12]=[r("span",{class:"status-icon"},"⏳",-1),E(" Validating API key... ",-1)]))):n(o).isConnected?(c(),p("div",be,e[13]||(e[13]=[r("span",{class:"status-icon"},"✅",-1),E(" API key validated successfully ",-1)]))):n(o).hasError?(c(),p("div",Le,[e[14]||(e[14]=r("span",{class:"status-icon"},"❌",-1)),E(" "+m(n(o).error)+" ",1),r("button",{class:"btn-link",onClick:e[2]||(e[2]=(...i)=>n(o).retry&&n(o).retry(...i))},"Retry")])):C("",!0),e[16]||(e[16]=r("small",{class:"help-text"}," Get your API key from the Govee Home app → Settings → About Us → Apply for API Key ",-1))])]),r("section",he,[e[22]||(e[22]=r("h2",null,"Group Management",-1)),n(s).isIdle?(c(),p("div",_e,[r("button",{class:"btn btn-primary",disabled:!n(o).isConnected,onClick:e[3]||(e[3]=(...i)=>n(s).loadGroups&&n(s).loadGroups(...i))}," Load Groups ",8,Ce),e[18]||(e[18]=r("small",{class:"help-text"}," Connect your API key first, then load your light groups ",-1))])):n(s).isLoadingGroups?(c(),p("div",ke,e[19]||(e[19]=[r("span",{class:"status-icon"},"⏳",-1),E(" Loading groups... ",-1)]))):n(s).hasError?(c(),p("div",Ie,[e[20]||(e[20]=r("span",{class:"status-icon"},"❌",-1)),E(" "+m(n(s).error)+" ",1),r("button",{class:"btn-link",onClick:e[4]||(e[4]=(...i)=>n(s).loadGroups&&n(s).loadGroups(...i))},"Retry")])):n(s).isReady?(c(),p("div",Te,[r("div",Se,[e[21]||(e[21]=r("label",{for:"groupSelect"},"Light Group",-1)),k(r("select",{id:"groupSelect","onUpdate:modelValue":e[5]||(e[5]=i=>G.value=i),class:"form-select",disabled:!n(s).hasGroups},[r("option",Pe,m(n(s).hasGroups?"Select a light group...":"No groups found"),1),(c(!0),p(W,null,$(n(s).groups,i=>(c(),p("option",{key:i.id,value:i.id},m(i.name)+" ("+m(i.lightIds.length)+" lights) ",9,Ae))),128))],8,De),[[B,G.value]])]),r("div",Oe,[r("button",{type:"button",class:"btn btn-secondary",disabled:!G.value||n(s).isLoading,onClick:R}," ✏️ Edit ",8,Re),r("button",{type:"button",class:"btn btn-danger",disabled:!G.value||n(s).isLoading,onClick:U},[n(s).isDeleting?(c(),p("span",we,"Deleting...")):(c(),p("span",Ve,"🗑️ Delete"))],8,Ue),r("button",{type:"button",class:"btn btn-primary",disabled:n(s).isLoading,onClick:x}," + Create New Group ",8,xe)])])):C("",!0)]),P.value||h.value?(c(),p("section",Ne,[r("h2",null,m(h.value?"Edit Group":"Create New Group"),1),n(s).isSaving?(c(),p("div",Me,[e[23]||(e[23]=r("span",{class:"status-icon"},"⏳",-1)),E(" "+m(h.value?"Updating group...":"Creating group..."),1)])):(c(),p("div",Ke,[r("div",Fe,[e[24]||(e[24]=r("label",{for:"groupName"},"Group Name",-1)),k(r("input",{id:"groupName","onUpdate:modelValue":e[6]||(e[6]=i=>d.value=i),type:"text",class:"form-input",placeholder:"Enter group name",disabled:n(s).isLoading},null,8,He),[[D,d.value]])]),r("div",Be,[e[29]||(e[29]=r("label",null,"Select Lights",-1)),n(a).isIdle?(c(),p("div",We,e[25]||(e[25]=[r("span",{class:"status-icon"},"⏳",-1),E(" Loading available lights... ",-1)]))):n(a).isFetchingLights?(c(),p("div",$e,e[26]||(e[26]=[r("span",{class:"status-icon"},"⏳",-1),E(" Discovering lights... ",-1)]))):n(a).hasError?(c(),p("div",qe,[e[27]||(e[27]=r("span",{class:"status-icon"},"❌",-1)),E(" "+m(n(a).error)+" ",1),r("button",{class:"btn-link",onClick:e[7]||(e[7]=(...i)=>n(a).retryFetch&&n(a).retryFetch(...i))},"Retry")])):n(a).isReady&&n(a).hasLights?(c(),p("div",ze,[(c(!0),p(W,null,$(n(a).lights,i=>(c(),p("div",{key:i.value,class:"light-checkbox"},[r("input",{id:`light-${i.value}`,checked:M(i.value),type:"checkbox",class:"checkbox",onChange:F=>N(i.value)},null,40,Je),r("label",{for:`light-${i.value}`,class:"checkbox-label"},m(i.label),9,Qe)]))),128))])):(c(),p("div",Xe,e[28]||(e[28]=[r("span",{class:"status-icon"},"ℹ️",-1),E(" No lights available. Make sure your API key is connected and lights are discoverable. ",-1)])))]),r("div",Ye,[r("button",{type:"button",class:"btn btn-secondary",disabled:n(s).isLoading,onClick:V}," Cancel ",8,Ze),r("button",{type:"button",class:"btn btn-primary",disabled:!d.value||I.value.length===0||n(s).isLoading,onClick:w},m(h.value?"Update Group":"Create Group"),9,je)])]))])):C("",!0),r("section",et,[e[35]||(e[35]=r("h2",null,"Control Mode",-1)),r("div",tt,[e[31]||(e[31]=r("label",{for:"controlMode"},"Control Mode",-1)),k(r("select",{id:"controlMode","onUpdate:modelValue":e[8]||(e[8]=i=>b.value=i),class:"form-select"},e[30]||(e[30]=[re('<option value="toggle" data-v-606cf608>Toggle On/Off</option><option value="on" data-v-606cf608>Turn On</option><option value="off" data-v-606cf608>Turn Off</option><option value="brightness" data-v-606cf608>Set Brightness</option><option value="color" data-v-606cf608>Set Color</option><option value="colorTemp" data-v-606cf608>Set Color Temperature</option>',6)]),512),[[B,b.value]])]),b.value==="brightness"?(c(),p("div",ot,[e[32]||(e[32]=r("label",{for:"brightness"},"Brightness (%)",-1)),k(r("input",{id:"brightness","onUpdate:modelValue":e[9]||(e[9]=i=>T.value=i),type:"range",min:"1",max:"100",class:"form-range"},null,512),[[D,T.value,void 0,{number:!0}]]),r("span",st,m(T.value)+"%",1)])):C("",!0),b.value==="color"?(c(),p("div",rt,[e[33]||(e[33]=r("label",{for:"color"},"Color",-1)),k(r("input",{id:"color","onUpdate:modelValue":e[10]||(e[10]=i=>A.value=i),type:"color",class:"form-color"},null,512),[[D,A.value]])])):C("",!0),b.value==="colorTemp"?(c(),p("div",nt,[e[34]||(e[34]=r("label",{for:"colorTemp"},"Color Temperature (K)",-1)),k(r("input",{id:"colorTemp","onUpdate:modelValue":e[11]||(e[11]=i=>S.value=i),type:"range",min:"2000",max:"9000",step:"100",class:"form-range"},null,512),[[D,S.value,void 0,{number:!0}]]),r("span",at,m(S.value)+"K",1)])):C("",!0)])]))}}),lt=ne(it,[["__scopeId","data-v-606cf608"]]);ae();const z=ie(le);z.component("main-view",lt);z.mount("#app");
//# sourceMappingURL=group-control.js.map
