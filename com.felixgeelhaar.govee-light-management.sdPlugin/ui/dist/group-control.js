import{y as X,z as y,B as K,C as f,r as L,c as g,o as q,D as Y,E as Z,d as j,u as ee,a as te,G as oe,w as H,e as p,f as c,g as s,h as C,j as k,v as D,k as se,l as n,m as b,t as m,n as B,F as W,p as $,q as re,_ as ne,s as ae,x as ie,A as le}from"./propertyInspectorInit.js";const ue=X({actions:{setGroups:y({groups:({event:t})=>t.type==="GROUPS_LOADED"?t.groups:[]}),setCurrentGroup:y({currentGroup:({event:t})=>t.type==="EDIT_GROUP"?t.group:null}),clearCurrentGroup:y({currentGroup:null,selectedLights:[]}),selectLight:y({selectedLights:({context:t,event:o})=>o.type==="SELECT_LIGHT"&&!t.selectedLights.includes(o.lightId)?[...t.selectedLights,o.lightId]:t.selectedLights}),deselectLight:y({selectedLights:({context:t,event:o})=>o.type==="DESELECT_LIGHT"?t.selectedLights.filter(l=>l!==o.lightId):t.selectedLights}),addOrUpdateGroup:y({groups:({context:t,event:o})=>{if(o.type==="GROUP_SAVED"){const l=t.groups.findIndex(r=>r.id===o.group.id);if(l>=0){const r=[...t.groups];return r[l]=o.group,r}else return[...t.groups,o.group]}return t.groups}}),removeGroup:y({groups:({context:t,event:o})=>o.type==="GROUP_DELETED"?t.groups.filter(l=>l.id!==o.groupId):t.groups}),setError:y({error:({event:t})=>t.type==="OPERATION_FAILED"?t.error:null}),clearError:y({error:null}),startLoading:y({isLoading:!0}),stopLoading:y({isLoading:!1})},actors:{loadGroups:K(async({input:t})=>{if(!f.isConnected)throw new Error("WebSocket not connected to Stream Deck");return new Promise((o,l)=>{const r=setTimeout(()=>{f.off("sendToPropertyInspector",i),l(new Error("Group loading timeout"))},1e4),i=d=>{d.payload?.event==="groupsReceived"&&(clearTimeout(r),f.off("sendToPropertyInspector",i),d.payload.error?l(new Error(d.payload.error)):o(d.payload.groups||[]))};f.on("sendToPropertyInspector",i),f.requestGroups()})}),saveGroup:K(async({input:t})=>{if(!f.isConnected)throw new Error("WebSocket not connected to Stream Deck");return new Promise((o,l)=>{const r=setTimeout(()=>{f.off("sendToPropertyInspector",i),l(new Error("Group save timeout"))},1e4),i=d=>{d.payload?.event==="groupSaved"&&(clearTimeout(r),f.off("sendToPropertyInspector",i),d.payload.error?l(new Error(d.payload.error)):o(d.payload.group))};f.on("sendToPropertyInspector",i),f.saveGroup({name:t.name,lightIds:t.selectedLights})})}),deleteGroup:K(async({input:t})=>{if(!f.isConnected)throw new Error("WebSocket not connected to Stream Deck");return new Promise((o,l)=>{const r=setTimeout(()=>{f.off("sendToPropertyInspector",i),l(new Error("Group delete timeout"))},1e4),i=d=>{d.payload?.event==="groupDeleted"&&(clearTimeout(r),f.off("sendToPropertyInspector",i),d.payload.error?l(new Error(d.payload.error)):o(d.payload.groupId))};f.on("sendToPropertyInspector",i),f.deleteGroup(t.groupId)})})}}).createMachine({id:"groupManagement",initial:"idle",context:({input:t})=>({groups:[],currentGroup:null,availableLights:[],selectedLights:[],error:null,isLoading:!1}),states:{idle:{on:{LOAD_GROUPS:{target:"loading"}}},loading:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"loadGroups",input:()=>({}),onDone:{target:"ready",actions:y({groups:({event:t})=>t.output})},onError:{target:"error",actions:y({error:({event:t})=>t.error?.message||"Unknown error"})}},on:{GROUPS_LOADED:{target:"ready",actions:"setGroups"},OPERATION_FAILED:{target:"error",actions:"setError"}}},ready:{on:{CREATE_GROUP:{target:"editing",actions:"clearCurrentGroup"},EDIT_GROUP:{target:"editing",actions:["setCurrentGroup",y({selectedLights:({event:t})=>t.type==="EDIT_GROUP"?t.group.lightIds||[]:[]})]},DELETE_GROUP:{target:"deleting"},LOAD_GROUPS:{target:"loading"}}},editing:{on:{SAVE_GROUP:{target:"saving"},CANCEL_EDIT:{target:"ready",actions:"clearCurrentGroup"},SELECT_LIGHT:{actions:"selectLight"},DESELECT_LIGHT:{actions:"deselectLight"}}},saving:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"saveGroup",input:({context:t,event:o,self:l})=>o.type==="SAVE_GROUP"?{name:o.name,selectedLights:o.selectedLights,groupId:t.currentGroup?.id}:{name:"",selectedLights:[]},onDone:{target:"ready",actions:[y({groups:({context:t,event:o})=>{const l=o.output,r=t.groups.findIndex(i=>i.id===l.id);if(r>=0){const i=[...t.groups];return i[r]=l,i}else return[...t.groups,l]}}),"clearCurrentGroup"]},onError:{target:"error",actions:y({error:({event:t})=>t.error?.message||"Unknown error"})}},on:{GROUP_SAVED:{target:"ready",actions:["addOrUpdateGroup","clearCurrentGroup"]},OPERATION_FAILED:{target:"error",actions:"setError"}}},deleting:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"deleteGroup",input:({event:t,self:o})=>t.type==="DELETE_GROUP"?{groupId:t.groupId}:{groupId:""},onDone:{target:"ready",actions:y({groups:({context:t,event:o})=>t.groups.filter(l=>l.id!==o.output)})},onError:{target:"error",actions:y({error:({event:t})=>t.error?.message||"Unknown error"})}},on:{GROUP_DELETED:{target:"ready",actions:"removeGroup"},OPERATION_FAILED:{target:"error",actions:"setError"}}},error:{on:{LOAD_GROUPS:{target:"loading",actions:"clearError"},CREATE_GROUP:{target:"editing",actions:["clearError","clearCurrentGroup"]}}}}});function de(){const t=L(null),o=L("idle"),l=L([]),r=L(null),i=L([]),d=L([]),P=L(null),h=L(!1),I=g(()=>o.value==="idle"),_=g(()=>o.value==="loading"),G=g(()=>o.value==="ready"),E=g(()=>o.value==="editing"),T=g(()=>o.value==="saving"),A=g(()=>o.value==="deleting"),S=g(()=>o.value==="error"),O=g(()=>l.value.length>0),U=g(()=>E.value&&r.value===null),w=g(()=>E.value&&r.value!==null);q(()=>{t.value=Y(ue,{input:{}}),t.value.subscribe(v=>{o.value=v.value,l.value=v.context.groups,r.value=v.context.currentGroup,i.value=v.context.availableLights,d.value=v.context.selectedLights,P.value=v.context.error,h.value=v.context.isLoading}),t.value.start()}),Z(()=>{t.value&&t.value.stop()});const R=()=>{t.value&&t.value.send({type:"LOAD_GROUPS"})},V=()=>{t.value&&t.value.send({type:"CREATE_GROUP"})},x=v=>{t.value&&t.value.send({type:"EDIT_GROUP",group:v})},N=(v,Q)=>{t.value&&t.value.send({type:"SAVE_GROUP",name:v,selectedLights:Q})},M=v=>{t.value&&t.value.send({type:"DELETE_GROUP",groupId:v})},u=()=>{t.value&&t.value.send({type:"CANCEL_EDIT"})},e=v=>{t.value&&t.value.send({type:"SELECT_LIGHT",lightId:v})},a=v=>{t.value&&t.value.send({type:"DESELECT_LIGHT",lightId:v})},F=v=>{d.value.includes(v)?a(v):e(v)},J=v=>g(()=>d.value.includes(v));return{state:g(()=>o.value),groups:g(()=>l.value),currentGroup:g(()=>r.value),availableLights:g(()=>i.value),selectedLights:g(()=>d.value),error:g(()=>P.value),isLoading:g(()=>h.value),isIdle:I,isLoadingGroups:_,isReady:G,isEditing:E,isSaving:T,isDeleting:A,hasError:S,hasGroups:O,isCreatingNew:U,isEditingExisting:w,loadGroups:R,createGroup:V,editGroup:x,saveGroup:N,deleteGroup:M,cancelEdit:u,selectLight:e,deselectLight:a,toggleLightSelection:F,isLightSelected:J}}const pe={class:"group-control-view"},ce={class:"config-section","data-testid":"api-key-section"},ge={class:"form-group"},ve={class:"input-group"},ye=["disabled"],fe=["disabled"],me={key:0},Ge={key:1},be={key:0,class:"status-message status-loading"},Ee={key:1,class:"status-message status-success"},Le={key:2,class:"status-message status-error"},he={class:"config-section","data-testid":"group-management-section"},_e={key:0,class:"form-group"},Ce=["disabled"],ke={key:1,class:"status-message status-loading"},Ie={key:2,class:"status-message status-error"},Te={key:3,class:"form-group"},Se={class:"form-group"},De=["disabled"],Pe={value:"",disabled:""},Ae=["value"],Oe={class:"group-actions"},Ue=["disabled"],we=["disabled"],Re={key:0},Ve={key:1},xe=["disabled"],Ne={key:0,class:"config-section","data-testid":"group-creation-form"},Me={key:0,class:"status-message status-loading"},Ke={key:1},Fe={class:"form-group"},He=["disabled"],Be={class:"form-group"},We={key:0,class:"status-message status-loading"},$e={key:1,class:"status-message status-loading"},qe={key:2,class:"status-message status-error"},ze={key:3,class:"light-selection"},Je=["id","checked","onChange"],Qe=["for"],Xe={key:4,class:"status-message status-error"},Ye={class:"form-actions"},Ze=["disabled"],je=["disabled"],et={class:"config-section","data-testid":"control-mode-section"},tt={class:"form-group"},ot={key:0,class:"form-group"},st={class:"range-value"},rt={key:1,class:"form-group"},nt={key:2,class:"form-group"},at={class:"range-value"},it=j({__name:"GroupControlView",setup(t){const o=ee(),l=te(),r=de(),i=oe(),d=L(""),P=g(()=>r.isCreatingNew.value),h=g(()=>r.isEditingExisting.value),I=g(()=>r.selectedLights.value),_=g({get:()=>i.settings.apiKey||"",set:u=>i.updateSetting("apiKey",u||void 0)}),G=g({get:()=>i.settings.selectedGroupId||"",set:u=>{if(i.updateSetting("selectedGroupId",u||void 0),u){const e=r.groups.value.find(a=>a.id===u);e&&i.updateSetting("selectedGroupName",e.name)}else i.updateSetting("selectedGroupName",void 0)}}),E=g({get:()=>i.settings.controlMode||"toggle",set:u=>i.updateSetting("controlMode",u)}),T=g({get:()=>i.settings.brightnessValue||100,set:u=>i.updateSetting("brightnessValue",u)}),A=g({get:()=>i.settings.colorValue||"#ffffff",set:u=>i.updateSetting("colorValue",u)}),S=g({get:()=>i.settings.colorTempValue||6500,set:u=>i.updateSetting("colorTempValue",u)}),O=()=>{_.value&&o.connect(_.value)},U=()=>{const u=r.groups.value.find(e=>e.id===G.value);u&&(r.editGroup(u),d.value=u.name)},w=()=>{G.value&&confirm("Are you sure you want to delete this group?")&&(r.deleteGroup(G.value),G.value="")},R=()=>{d.value&&I.value.length>0&&(r.saveGroup(d.value,I.value),d.value="")},V=()=>{r.cancelEdit(),d.value=""},x=()=>{r.createGroup(),d.value=""},N=u=>{r.toggleLightSelection(u)},M=u=>r.isLightSelected(u).value;return H(()=>o.isConnected.value,u=>{u&&(l.isIdle.value&&l.fetchLights(),r.isIdle.value&&r.loadGroups())}),H(()=>i.settings.apiKey,u=>{u&&!o.isConnected.value&&o.connect(u)}),q(()=>{i.enableAutoSave(500),i.loadSettings(),i.settings.apiKey&&o.connect(i.settings.apiKey),o.isConnected.value&&r.isIdle.value&&r.loadGroups()}),(u,e)=>(c(),p("div",pe,[s("section",ce,[e[17]||(e[17]=s("h2",null,"API Configuration",-1)),s("div",ge,[e[15]||(e[15]=s("label",{for:"apiKey"},"API Key",-1)),s("div",ve,[k(s("input",{id:"apiKey","onUpdate:modelValue":e[0]||(e[0]=a=>_.value=a),type:"password",class:"form-input",placeholder:"Enter your Govee API key",autocomplete:"off",disabled:n(o).isConnecting.value,onKeyup:se(O,["enter"])},null,40,ye),[[D,_.value]]),n(o).isDisconnected||n(o).hasError?(c(),p("button",{key:0,class:"btn btn-primary",disabled:!_.value||n(o).isConnecting.value,onClick:O},[n(o).isConnecting?(c(),p("span",me,"Connecting...")):(c(),p("span",Ge,"Connect"))],8,fe)):n(o).isConnected?(c(),p("button",{key:1,class:"btn btn-secondary",onClick:e[1]||(e[1]=(...a)=>n(o).disconnect&&n(o).disconnect(...a))}," Disconnect ")):C("",!0)]),n(o).isConnecting?(c(),p("div",be,e[12]||(e[12]=[s("span",{class:"status-icon"},"⏳",-1),b(" Validating API key... ",-1)]))):n(o).isConnected?(c(),p("div",Ee,e[13]||(e[13]=[s("span",{class:"status-icon"},"✅",-1),b(" API key validated successfully ",-1)]))):n(o).hasError?(c(),p("div",Le,[e[14]||(e[14]=s("span",{class:"status-icon"},"❌",-1)),b(" "+m(n(o).error)+" ",1),s("button",{class:"btn-link",onClick:e[2]||(e[2]=(...a)=>n(o).retry&&n(o).retry(...a))},"Retry")])):C("",!0),e[16]||(e[16]=s("small",{class:"help-text"}," Get your API key from the Govee Home app → Settings → About Us → Apply for API Key ",-1))])]),s("section",he,[e[22]||(e[22]=s("h2",null,"Group Management",-1)),n(r).isIdle?(c(),p("div",_e,[s("button",{class:"btn btn-primary",disabled:!n(o).isConnected,onClick:e[3]||(e[3]=(...a)=>n(r).loadGroups&&n(r).loadGroups(...a))}," Load Groups ",8,Ce),e[18]||(e[18]=s("small",{class:"help-text"}," Connect your API key first, then load your light groups ",-1))])):n(r).isLoadingGroups?(c(),p("div",ke,e[19]||(e[19]=[s("span",{class:"status-icon"},"⏳",-1),b(" Loading groups... ",-1)]))):n(r).hasError?(c(),p("div",Ie,[e[20]||(e[20]=s("span",{class:"status-icon"},"❌",-1)),b(" "+m(n(r).error)+" ",1),s("button",{class:"btn-link",onClick:e[4]||(e[4]=(...a)=>n(r).loadGroups&&n(r).loadGroups(...a))},"Retry")])):n(r).isReady?(c(),p("div",Te,[s("div",Se,[e[21]||(e[21]=s("label",{for:"groupSelect"},"Light Group",-1)),k(s("select",{id:"groupSelect","onUpdate:modelValue":e[5]||(e[5]=a=>G.value=a),class:"form-select",disabled:!n(r).hasGroups},[s("option",Pe,m(n(r).hasGroups?"Select a light group...":"No groups found"),1),(c(!0),p(W,null,$(n(r).groups.value,a=>(c(),p("option",{key:a.id,value:a.id},m(a.name)+" ("+m(a.lightIds?.length||0)+" lights) ",9,Ae))),128))],8,De),[[B,G.value]])]),s("div",Oe,[s("button",{type:"button",class:"btn btn-secondary",disabled:!G.value||n(r).isLoading.value,onClick:U}," ✏️ Edit ",8,Ue),s("button",{type:"button",class:"btn btn-danger",disabled:!G.value||n(r).isLoading.value,onClick:w},[n(r).isDeleting?(c(),p("span",Re,"Deleting...")):(c(),p("span",Ve,"🗑️ Delete"))],8,we),s("button",{type:"button",class:"btn btn-primary",disabled:n(r).isLoading.value,onClick:x}," + Create New Group ",8,xe)])])):C("",!0)]),P.value||h.value?(c(),p("section",Ne,[s("h2",null,m(h.value?"Edit Group":"Create New Group"),1),n(r).isSaving?(c(),p("div",Me,[e[23]||(e[23]=s("span",{class:"status-icon"},"⏳",-1)),b(" "+m(h.value?"Updating group...":"Creating group..."),1)])):(c(),p("div",Ke,[s("div",Fe,[e[24]||(e[24]=s("label",{for:"groupName"},"Group Name",-1)),k(s("input",{id:"groupName","onUpdate:modelValue":e[6]||(e[6]=a=>d.value=a),type:"text",class:"form-input",placeholder:"Enter group name",disabled:n(r).isLoading.value},null,8,He),[[D,d.value]])]),s("div",Be,[e[29]||(e[29]=s("label",null,"Select Lights",-1)),n(l).isIdle?(c(),p("div",We,e[25]||(e[25]=[s("span",{class:"status-icon"},"⏳",-1),b(" Loading available lights... ",-1)]))):n(l).isFetchingLights?(c(),p("div",$e,e[26]||(e[26]=[s("span",{class:"status-icon"},"⏳",-1),b(" Discovering lights... ",-1)]))):n(l).hasError?(c(),p("div",qe,[e[27]||(e[27]=s("span",{class:"status-icon"},"❌",-1)),b(" "+m(n(l).error)+" ",1),s("button",{class:"btn-link",onClick:e[7]||(e[7]=(...a)=>n(l).retryFetch&&n(l).retryFetch(...a))},"Retry")])):n(l).isReady&&n(l).hasLights?(c(),p("div",ze,[(c(!0),p(W,null,$(n(l).lights.value,a=>(c(),p("div",{key:a.value,class:"light-checkbox"},[s("input",{id:`light-${a.value}`,checked:M(a.value),type:"checkbox",class:"checkbox",onChange:F=>N(a.value)},null,40,Je),s("label",{for:`light-${a.value}`,class:"checkbox-label"},m(a.label),9,Qe)]))),128))])):(c(),p("div",Xe,e[28]||(e[28]=[s("span",{class:"status-icon"},"ℹ️",-1),b(" No lights available. Make sure your API key is connected and lights are discoverable. ",-1)])))]),s("div",Ye,[s("button",{type:"button",class:"btn btn-secondary",disabled:n(r).isLoading.value,onClick:V}," Cancel ",8,Ze),s("button",{type:"button",class:"btn btn-primary",disabled:!d.value||I.value.length===0||n(r).isLoading.value,onClick:R},m(h.value?"Update Group":"Create Group"),9,je)])]))])):C("",!0),s("section",et,[e[35]||(e[35]=s("h2",null,"Control Mode",-1)),s("div",tt,[e[31]||(e[31]=s("label",{for:"controlMode"},"Control Mode",-1)),k(s("select",{id:"controlMode","onUpdate:modelValue":e[8]||(e[8]=a=>E.value=a),class:"form-select"},e[30]||(e[30]=[re('<option value="toggle" data-v-084e5b15>Toggle On/Off</option><option value="on" data-v-084e5b15>Turn On</option><option value="off" data-v-084e5b15>Turn Off</option><option value="brightness" data-v-084e5b15>Set Brightness</option><option value="color" data-v-084e5b15>Set Color</option><option value="colorTemp" data-v-084e5b15>Set Color Temperature</option>',6)]),512),[[B,E.value]])]),E.value==="brightness"?(c(),p("div",ot,[e[32]||(e[32]=s("label",{for:"brightness"},"Brightness (%)",-1)),k(s("input",{id:"brightness","onUpdate:modelValue":e[9]||(e[9]=a=>T.value=a),type:"range",min:"1",max:"100",class:"form-range"},null,512),[[D,T.value,void 0,{number:!0}]]),s("span",st,m(T.value)+"%",1)])):C("",!0),E.value==="color"?(c(),p("div",rt,[e[33]||(e[33]=s("label",{for:"color"},"Color",-1)),k(s("input",{id:"color","onUpdate:modelValue":e[10]||(e[10]=a=>A.value=a),type:"color",class:"form-color"},null,512),[[D,A.value]])])):C("",!0),E.value==="colorTemp"?(c(),p("div",nt,[e[34]||(e[34]=s("label",{for:"colorTemp"},"Color Temperature (K)",-1)),k(s("input",{id:"colorTemp","onUpdate:modelValue":e[11]||(e[11]=a=>S.value=a),type:"range",min:"2000",max:"9000",step:"100",class:"form-range"},null,512),[[D,S.value,void 0,{number:!0}]]),s("span",at,m(S.value)+"K",1)])):C("",!0)])]))}}),lt=ne(it,[["__scopeId","data-v-084e5b15"]]);ae();const z=ie(le);z.component("main-view",lt);z.mount("#app");
//# sourceMappingURL=group-control.js.map
