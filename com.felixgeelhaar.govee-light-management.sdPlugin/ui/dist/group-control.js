import{s as J,p,q as F,r as g,c,x as B,y as Q,z as W,d as X,u as Y,a as Z,w as ee,b as l,o as u,e as o,f as h,g as _,v as A,h as te,i as n,j as b,t as G,k as M,F as K,l as H,m as se,_ as oe,n as re,A as ne}from"./useLightDiscovery.js";const ae=J({actions:{setGroups:p({groups:({event:e})=>e.type==="GROUPS_LOADED"?e.groups:[]}),setCurrentGroup:p({currentGroup:({event:e})=>e.type==="EDIT_GROUP"?e.group:null}),clearCurrentGroup:p({currentGroup:null,selectedLights:[]}),selectLight:p({selectedLights:({context:e,event:s})=>s.type==="SELECT_LIGHT"&&!e.selectedLights.includes(s.lightId)?[...e.selectedLights,s.lightId]:e.selectedLights}),deselectLight:p({selectedLights:({context:e,event:s})=>s.type==="DESELECT_LIGHT"?e.selectedLights.filter(a=>a!==s.lightId):e.selectedLights}),addOrUpdateGroup:p({groups:({context:e,event:s})=>{if(s.type==="GROUP_SAVED"){const a=e.groups.findIndex(r=>r.id===s.group.id);if(a>=0){const r=[...e.groups];return r[a]=s.group,r}else return[...e.groups,s.group]}return e.groups}}),removeGroup:p({groups:({context:e,event:s})=>s.type==="GROUP_DELETED"?e.groups.filter(a=>a.id!==s.groupId):e.groups}),setError:p({error:({event:e})=>e.type==="OPERATION_FAILED"?e.error:null}),clearError:p({error:null}),startLoading:p({isLoading:!0}),stopLoading:p({isLoading:!1})},actors:{loadGroups:F(async({input:e})=>new Promise((s,a)=>{setTimeout(()=>{e.shouldFailLoad?a(new Error("Failed to load groups")):s([{id:"group1",name:"Living Room",lightIds:["device1|H6054","device2|H6072"],isActive:!0},{id:"group2",name:"Bedroom",lightIds:["device3|H6056"],isActive:!1}])},50)})),saveGroup:F(async({input:e})=>new Promise((s,a)=>{setTimeout(()=>{if(e.shouldFailSave)a(new Error("Failed to save group"));else{const r={id:e.groupId||`group_${Date.now()}`,name:e.name,lightIds:e.selectedLights,isActive:!1};s(r)}},50)})),deleteGroup:F(async({input:e})=>new Promise((s,a)=>{setTimeout(()=>{e.shouldFailDelete?a(new Error("Failed to delete group")):s(e.groupId)},50)}))}}).createMachine({id:"groupManagement",initial:"idle",context:({input:e})=>({groups:[],currentGroup:null,availableLights:[],selectedLights:[],error:null,isLoading:!1}),states:{idle:{on:{LOAD_GROUPS:{target:"loading"}}},loading:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"loadGroups",input:({self:e})=>e._parent?.input||{},onDone:{target:"ready",actions:p({groups:({event:e})=>e.output})},onError:{target:"error",actions:p({error:({event:e})=>e.error.message})}},on:{GROUPS_LOADED:{target:"ready",actions:"setGroups"},OPERATION_FAILED:{target:"error",actions:"setError"}}},ready:{on:{CREATE_GROUP:{target:"editing",actions:"clearCurrentGroup"},EDIT_GROUP:{target:"editing",actions:["setCurrentGroup",p({selectedLights:({event:e})=>e.type==="EDIT_GROUP"?e.group.lightIds:[]})]},DELETE_GROUP:{target:"deleting"},LOAD_GROUPS:{target:"loading"}}},editing:{on:{SAVE_GROUP:{target:"saving"},CANCEL_EDIT:{target:"ready",actions:"clearCurrentGroup"},SELECT_LIGHT:{actions:"selectLight"},DESELECT_LIGHT:{actions:"deselectLight"}}},saving:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"saveGroup",input:({context:e,event:s,self:a})=>{const r=a._parent?.input||{};return s.type==="SAVE_GROUP"?{...r,name:s.name,selectedLights:s.selectedLights,groupId:e.currentGroup?.id}:r},onDone:{target:"ready",actions:[p({groups:({context:e,event:s})=>{const a=s.output,r=e.groups.findIndex(m=>m.id===a.id);if(r>=0){const m=[...e.groups];return m[r]=a,m}else return[...e.groups,a]}}),"clearCurrentGroup"]},onError:{target:"error",actions:p({error:({event:e})=>e.error.message})}},on:{GROUP_SAVED:{target:"ready",actions:["addOrUpdateGroup","clearCurrentGroup"]},OPERATION_FAILED:{target:"error",actions:"setError"}}},deleting:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"deleteGroup",input:({event:e,self:s})=>{const a=s._parent?.input||{};return e.type==="DELETE_GROUP"?{...a,groupId:e.groupId}:a},onDone:{target:"ready",actions:p({groups:({context:e,event:s})=>e.groups.filter(a=>a.id!==s.output)})},onError:{target:"error",actions:p({error:({event:e})=>e.error.message})}},on:{GROUP_DELETED:{target:"ready",actions:"removeGroup"},OPERATION_FAILED:{target:"error",actions:"setError"}}},error:{on:{LOAD_GROUPS:{target:"loading",actions:"clearError"},CREATE_GROUP:{target:"editing",actions:["clearError","clearCurrentGroup"]}}}}});function ie(){const e=g(null),s=g("idle"),a=g([]),r=g(null),m=g([]),v=g([]),f=g(null),E=g(!1),I=c(()=>s.value==="idle"),C=c(()=>s.value==="loading"),L=c(()=>s.value==="ready"),D=c(()=>s.value==="editing"),k=c(()=>s.value==="saving"),T=c(()=>s.value==="deleting"),O=c(()=>s.value==="error"),P=c(()=>a.value.length>0),R=c(()=>D.value&&r.value===null),S=c(()=>D.value&&r.value!==null);B(()=>{e.value=Q(ae),e.value.subscribe(d=>{s.value=d.value,a.value=d.context.groups,r.value=d.context.currentGroup,m.value=d.context.availableLights,v.value=d.context.selectedLights,f.value=d.context.error,E.value=d.context.isLoading}),e.value.start()}),W(()=>{e.value&&e.value.stop()});const U=()=>{e.value&&e.value.send({type:"LOAD_GROUPS"})},w=()=>{e.value&&e.value.send({type:"CREATE_GROUP"})},V=d=>{e.value&&e.value.send({type:"EDIT_GROUP",group:d})},x=(d,z)=>{e.value&&e.value.send({type:"SAVE_GROUP",name:d,selectedLights:z})},y=d=>{e.value&&e.value.send({type:"DELETE_GROUP",groupId:d})},t=()=>{e.value&&e.value.send({type:"CANCEL_EDIT"})},i=d=>{e.value&&e.value.send({type:"SELECT_LIGHT",lightId:d})},N=d=>{e.value&&e.value.send({type:"DESELECT_LIGHT",lightId:d})},j=d=>{v.value.includes(d)?N(d):i(d)},q=d=>c(()=>v.value.includes(d));return{state:c(()=>s.value),groups:c(()=>a.value),currentGroup:c(()=>r.value),availableLights:c(()=>m.value),selectedLights:c(()=>v.value),error:c(()=>f.value),isLoading:c(()=>E.value),isIdle:I,isLoadingGroups:C,isReady:L,isEditing:D,isSaving:k,isDeleting:T,hasError:O,hasGroups:P,isCreatingNew:R,isEditingExisting:S,loadGroups:U,createGroup:w,editGroup:V,saveGroup:x,deleteGroup:y,cancelEdit:t,selectLight:i,deselectLight:N,toggleLightSelection:j,isLightSelected:q}}const le={class:"group-control-view"},ue={class:"config-section","data-testid":"api-key-section"},de={class:"form-group"},ce={class:"input-group"},pe=["disabled"],ge=["disabled"],ve={key:0},me={key:1},ye={key:0,class:"status-message status-loading"},fe={key:1,class:"status-message status-success"},Ge={key:2,class:"status-message status-error"},Le={class:"config-section","data-testid":"group-management-section"},be={key:0,class:"form-group"},Ee=["disabled"],he={key:1,class:"status-message status-loading"},_e={key:2,class:"status-message status-error"},Ce={key:3,class:"form-group"},ke={class:"form-group"},Ie=["disabled"],De={value:"",disabled:""},Te=["value"],Ae={class:"group-actions"},Oe=["disabled"],Pe=["disabled"],Re={key:0},Se={key:1},Ue=["disabled"],we={key:0,class:"config-section","data-testid":"group-creation-form"},Ve={key:0,class:"status-message status-loading"},xe={key:1},Ne={class:"form-group"},Fe=["disabled"],Me={class:"form-group"},Ke={key:0,class:"status-message status-loading"},He={key:1,class:"status-message status-loading"},Be={key:2,class:"status-message status-error"},$e={key:3,class:"light-selection"},je=["id","checked","onChange"],qe=["for"],ze={key:4,class:"status-message status-error"},Je={class:"form-actions"},Qe=["disabled"],We=["disabled"],Xe={class:"config-section","data-testid":"control-mode-section"},Ye={class:"form-group"},Ze={key:0,class:"form-group"},et={class:"range-value"},tt={key:1,class:"form-group"},st={key:2,class:"form-group"},ot={class:"range-value"},rt=X({__name:"GroupControlView",setup(e){const s=Y(),a=Z(),r=ie(),m=g(""),v=g(""),f=g("toggle"),E=g(100),I=g("#ffffff"),C=g(6500),L=g(""),D=c(()=>r.isCreatingNew.value),k=c(()=>r.isEditingExisting.value),T=c(()=>r.selectedLights.value),O=()=>{m.value&&s.connect(m.value)},P=()=>{const y=r.groups.value.find(t=>t.id===v.value);y&&(r.editGroup(y),L.value=y.name)},R=()=>{v.value&&confirm("Are you sure you want to delete this group?")&&(r.deleteGroup(v.value),v.value="")},S=()=>{L.value&&T.value.length>0&&(r.saveGroup(L.value,T.value),L.value="")},U=()=>{r.cancelEdit(),L.value=""},w=()=>{r.createGroup(),L.value=""},V=y=>{r.toggleLightSelection(y)},x=y=>r.isLightSelected(y).value;return ee(()=>s.isConnected.value,y=>{y&&(a.isIdle.value&&a.fetchLights(),r.isIdle.value&&r.loadGroups())}),B(()=>{s.isConnected.value&&r.isIdle.value&&r.loadGroups()}),c(()=>({apiKey:s.apiKey.value||void 0,selectedGroupId:v.value||void 0,controlMode:f.value,brightnessValue:f.value==="brightness"?E.value:void 0,colorValue:f.value==="color"?I.value:void 0,colorTempValue:f.value==="colorTemp"?C.value:void 0})),(y,t)=>(u(),l("div",le,[o("section",ue,[t[17]||(t[17]=o("h2",null,"API Configuration",-1)),o("div",de,[t[15]||(t[15]=o("label",{for:"apiKey"},"API Key",-1)),o("div",ce,[_(o("input",{id:"apiKey","onUpdate:modelValue":t[0]||(t[0]=i=>m.value=i),type:"password",class:"form-input",placeholder:"Enter your Govee API key",autocomplete:"off",disabled:n(s).isConnecting,onKeyup:te(O,["enter"])},null,40,pe),[[A,m.value]]),n(s).isDisconnected||n(s).hasError?(u(),l("button",{key:0,class:"btn btn-primary",disabled:!m.value||n(s).isConnecting,onClick:O},[n(s).isConnecting?(u(),l("span",ve,"Connecting...")):(u(),l("span",me,"Connect"))],8,ge)):n(s).isConnected?(u(),l("button",{key:1,class:"btn btn-secondary",onClick:t[1]||(t[1]=(...i)=>n(s).disconnect&&n(s).disconnect(...i))}," Disconnect ")):h("",!0)]),n(s).isConnecting?(u(),l("div",ye,t[12]||(t[12]=[o("span",{class:"status-icon"},"⏳",-1),b(" Validating API key... ",-1)]))):n(s).isConnected?(u(),l("div",fe,t[13]||(t[13]=[o("span",{class:"status-icon"},"✅",-1),b(" API key validated successfully ",-1)]))):n(s).hasError?(u(),l("div",Ge,[t[14]||(t[14]=o("span",{class:"status-icon"},"❌",-1)),b(" "+G(n(s).error)+" ",1),o("button",{class:"btn-link",onClick:t[2]||(t[2]=(...i)=>n(s).retry&&n(s).retry(...i))},"Retry")])):h("",!0),t[16]||(t[16]=o("small",{class:"help-text"}," Get your API key from the Govee Home app → Settings → About Us → Apply for API Key ",-1))])]),o("section",Le,[t[22]||(t[22]=o("h2",null,"Group Management",-1)),n(r).isIdle?(u(),l("div",be,[o("button",{class:"btn btn-primary",disabled:!n(s).isConnected,onClick:t[3]||(t[3]=(...i)=>n(r).loadGroups&&n(r).loadGroups(...i))}," Load Groups ",8,Ee),t[18]||(t[18]=o("small",{class:"help-text"}," Connect your API key first, then load your light groups ",-1))])):n(r).isLoadingGroups?(u(),l("div",he,t[19]||(t[19]=[o("span",{class:"status-icon"},"⏳",-1),b(" Loading groups... ",-1)]))):n(r).hasError?(u(),l("div",_e,[t[20]||(t[20]=o("span",{class:"status-icon"},"❌",-1)),b(" "+G(n(r).error)+" ",1),o("button",{class:"btn-link",onClick:t[4]||(t[4]=(...i)=>n(r).loadGroups&&n(r).loadGroups(...i))},"Retry")])):n(r).isReady?(u(),l("div",Ce,[o("div",ke,[t[21]||(t[21]=o("label",{for:"groupSelect"},"Light Group",-1)),_(o("select",{id:"groupSelect","onUpdate:modelValue":t[5]||(t[5]=i=>v.value=i),class:"form-select",disabled:!n(r).hasGroups},[o("option",De,G(n(r).hasGroups?"Select a light group...":"No groups found"),1),(u(!0),l(K,null,H(n(r).groups,i=>(u(),l("option",{key:i.id,value:i.id},G(i.name)+" ("+G(i.lightIds.length)+" lights) ",9,Te))),128))],8,Ie),[[M,v.value]])]),o("div",Ae,[o("button",{type:"button",class:"btn btn-secondary",disabled:!v.value||n(r).isLoading,onClick:P}," ✏️ Edit ",8,Oe),o("button",{type:"button",class:"btn btn-danger",disabled:!v.value||n(r).isLoading,onClick:R},[n(r).isDeleting?(u(),l("span",Re,"Deleting...")):(u(),l("span",Se,"🗑️ Delete"))],8,Pe),o("button",{type:"button",class:"btn btn-primary",disabled:n(r).isLoading,onClick:w}," + Create New Group ",8,Ue)])])):h("",!0)]),D.value||k.value?(u(),l("section",we,[o("h2",null,G(k.value?"Edit Group":"Create New Group"),1),n(r).isSaving?(u(),l("div",Ve,[t[23]||(t[23]=o("span",{class:"status-icon"},"⏳",-1)),b(" "+G(k.value?"Updating group...":"Creating group..."),1)])):(u(),l("div",xe,[o("div",Ne,[t[24]||(t[24]=o("label",{for:"groupName"},"Group Name",-1)),_(o("input",{id:"groupName","onUpdate:modelValue":t[6]||(t[6]=i=>L.value=i),type:"text",class:"form-input",placeholder:"Enter group name",disabled:n(r).isLoading},null,8,Fe),[[A,L.value]])]),o("div",Me,[t[29]||(t[29]=o("label",null,"Select Lights",-1)),n(a).isIdle?(u(),l("div",Ke,t[25]||(t[25]=[o("span",{class:"status-icon"},"⏳",-1),b(" Loading available lights... ",-1)]))):n(a).isFetchingLights?(u(),l("div",He,t[26]||(t[26]=[o("span",{class:"status-icon"},"⏳",-1),b(" Discovering lights... ",-1)]))):n(a).hasError?(u(),l("div",Be,[t[27]||(t[27]=o("span",{class:"status-icon"},"❌",-1)),b(" "+G(n(a).error)+" ",1),o("button",{class:"btn-link",onClick:t[7]||(t[7]=(...i)=>n(a).retryFetch&&n(a).retryFetch(...i))},"Retry")])):n(a).isReady&&n(a).hasLights?(u(),l("div",$e,[(u(!0),l(K,null,H(n(a).lights,i=>(u(),l("div",{key:i.value,class:"light-checkbox"},[o("input",{id:`light-${i.value}`,checked:x(i.value),type:"checkbox",class:"checkbox",onChange:N=>V(i.value)},null,40,je),o("label",{for:`light-${i.value}`,class:"checkbox-label"},G(i.label),9,qe)]))),128))])):(u(),l("div",ze,t[28]||(t[28]=[o("span",{class:"status-icon"},"ℹ️",-1),b(" No lights available. Make sure your API key is connected and lights are discoverable. ",-1)])))]),o("div",Je,[o("button",{type:"button",class:"btn btn-secondary",disabled:n(r).isLoading,onClick:U}," Cancel ",8,Qe),o("button",{type:"button",class:"btn btn-primary",disabled:!L.value||T.value.length===0||n(r).isLoading,onClick:S},G(k.value?"Update Group":"Create Group"),9,We)])]))])):h("",!0),o("section",Xe,[t[35]||(t[35]=o("h2",null,"Control Mode",-1)),o("div",Ye,[t[31]||(t[31]=o("label",{for:"controlMode"},"Control Mode",-1)),_(o("select",{id:"controlMode","onUpdate:modelValue":t[8]||(t[8]=i=>f.value=i),class:"form-select"},t[30]||(t[30]=[se('<option value="toggle" data-v-0197973d>Toggle On/Off</option><option value="on" data-v-0197973d>Turn On</option><option value="off" data-v-0197973d>Turn Off</option><option value="brightness" data-v-0197973d>Set Brightness</option><option value="color" data-v-0197973d>Set Color</option><option value="colorTemp" data-v-0197973d>Set Color Temperature</option>',6)]),512),[[M,f.value]])]),f.value==="brightness"?(u(),l("div",Ze,[t[32]||(t[32]=o("label",{for:"brightness"},"Brightness (%)",-1)),_(o("input",{id:"brightness","onUpdate:modelValue":t[9]||(t[9]=i=>E.value=i),type:"range",min:"1",max:"100",class:"form-range"},null,512),[[A,E.value,void 0,{number:!0}]]),o("span",et,G(E.value)+"%",1)])):h("",!0),f.value==="color"?(u(),l("div",tt,[t[33]||(t[33]=o("label",{for:"color"},"Color",-1)),_(o("input",{id:"color","onUpdate:modelValue":t[10]||(t[10]=i=>I.value=i),type:"color",class:"form-color"},null,512),[[A,I.value]])])):h("",!0),f.value==="colorTemp"?(u(),l("div",st,[t[34]||(t[34]=o("label",{for:"colorTemp"},"Color Temperature (K)",-1)),_(o("input",{id:"colorTemp","onUpdate:modelValue":t[11]||(t[11]=i=>C.value=i),type:"range",min:"2000",max:"9000",step:"100",class:"form-range"},null,512),[[A,C.value,void 0,{number:!0}]]),o("span",ot,G(C.value)+"K",1)])):h("",!0)])]))}}),nt=oe(rt,[["__scopeId","data-v-0197973d"]]),$=re(ne);$.mount("#app");$.component("main-view",nt);
//# sourceMappingURL=group-control.js.map
