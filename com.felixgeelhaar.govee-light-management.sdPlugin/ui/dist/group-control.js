import{s as Q,q as v,x as F,y,r as f,c as g,z as W,B as X,C as Y,d as Z,u as j,a as ee,w as te,b as u,o as d,e as r,f as _,g as C,v as S,h as oe,i as n,j as L,t as E,k as K,F as H,l as B,m as se,_ as re,n as ne,p as ae,A as ie}from"./propertyInspectorInit.js";const le=Q({actions:{setGroups:v({groups:({event:e})=>e.type==="GROUPS_LOADED"?e.groups:[]}),setCurrentGroup:v({currentGroup:({event:e})=>e.type==="EDIT_GROUP"?e.group:null}),clearCurrentGroup:v({currentGroup:null,selectedLights:[]}),selectLight:v({selectedLights:({context:e,event:o})=>o.type==="SELECT_LIGHT"&&!e.selectedLights.includes(o.lightId)?[...e.selectedLights,o.lightId]:e.selectedLights}),deselectLight:v({selectedLights:({context:e,event:o})=>o.type==="DESELECT_LIGHT"?e.selectedLights.filter(a=>a!==o.lightId):e.selectedLights}),addOrUpdateGroup:v({groups:({context:e,event:o})=>{if(o.type==="GROUP_SAVED"){const a=e.groups.findIndex(s=>s.id===o.group.id);if(a>=0){const s=[...e.groups];return s[a]=o.group,s}else return[...e.groups,o.group]}return e.groups}}),removeGroup:v({groups:({context:e,event:o})=>o.type==="GROUP_DELETED"?e.groups.filter(a=>a.id!==o.groupId):e.groups}),setError:v({error:({event:e})=>e.type==="OPERATION_FAILED"?e.error:null}),clearError:v({error:null}),startLoading:v({isLoading:!0}),stopLoading:v({isLoading:!1})},actors:{loadGroups:F(async({input:e})=>{if(!y.isConnected)throw new Error("WebSocket not connected to Stream Deck");return new Promise((o,a)=>{const s=setTimeout(()=>{y.off("sendToPropertyInspector",p),a(new Error("Group loading timeout"))},1e4),p=l=>{l.payload?.event==="groupsReceived"&&(clearTimeout(s),y.off("sendToPropertyInspector",p),l.payload.error?a(new Error(l.payload.error)):o(l.payload.groups||[]))};y.on("sendToPropertyInspector",p),y.requestGroups()})}),saveGroup:F(async({input:e})=>{if(!y.isConnected)throw new Error("WebSocket not connected to Stream Deck");return new Promise((o,a)=>{const s=setTimeout(()=>{y.off("sendToPropertyInspector",p),a(new Error("Group save timeout"))},1e4),p=l=>{l.payload?.event==="groupSaved"&&(clearTimeout(s),y.off("sendToPropertyInspector",p),l.payload.error?a(new Error(l.payload.error)):o(l.payload.group))};y.on("sendToPropertyInspector",p),y.saveGroup({name:e.name,lightIds:e.selectedLights})})}),deleteGroup:F(async({input:e})=>{if(!y.isConnected)throw new Error("WebSocket not connected to Stream Deck");return new Promise((o,a)=>{const s=setTimeout(()=>{y.off("sendToPropertyInspector",p),a(new Error("Group delete timeout"))},1e4),p=l=>{l.payload?.event==="groupDeleted"&&(clearTimeout(s),y.off("sendToPropertyInspector",p),l.payload.error?a(new Error(l.payload.error)):o(l.payload.groupId))};y.on("sendToPropertyInspector",p),y.deleteGroup(e.groupId)})})}}).createMachine({id:"groupManagement",initial:"idle",context:({input:e})=>({groups:[],currentGroup:null,availableLights:[],selectedLights:[],error:null,isLoading:!1}),states:{idle:{on:{LOAD_GROUPS:{target:"loading"}}},loading:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"loadGroups",input:({self:e})=>e._parent?.input||{},onDone:{target:"ready",actions:v({groups:({event:e})=>e.output})},onError:{target:"error",actions:v({error:({event:e})=>e.error.message})}},on:{GROUPS_LOADED:{target:"ready",actions:"setGroups"},OPERATION_FAILED:{target:"error",actions:"setError"}}},ready:{on:{CREATE_GROUP:{target:"editing",actions:"clearCurrentGroup"},EDIT_GROUP:{target:"editing",actions:["setCurrentGroup",v({selectedLights:({event:e})=>e.type==="EDIT_GROUP"?e.group.lightIds:[]})]},DELETE_GROUP:{target:"deleting"},LOAD_GROUPS:{target:"loading"}}},editing:{on:{SAVE_GROUP:{target:"saving"},CANCEL_EDIT:{target:"ready",actions:"clearCurrentGroup"},SELECT_LIGHT:{actions:"selectLight"},DESELECT_LIGHT:{actions:"deselectLight"}}},saving:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"saveGroup",input:({context:e,event:o,self:a})=>{const s=a._parent?.input||{};return o.type==="SAVE_GROUP"?{...s,name:o.name,selectedLights:o.selectedLights,groupId:e.currentGroup?.id}:s},onDone:{target:"ready",actions:[v({groups:({context:e,event:o})=>{const a=o.output,s=e.groups.findIndex(p=>p.id===a.id);if(s>=0){const p=[...e.groups];return p[s]=a,p}else return[...e.groups,a]}}),"clearCurrentGroup"]},onError:{target:"error",actions:v({error:({event:e})=>e.error.message})}},on:{GROUP_SAVED:{target:"ready",actions:["addOrUpdateGroup","clearCurrentGroup"]},OPERATION_FAILED:{target:"error",actions:"setError"}}},deleting:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"deleteGroup",input:({event:e,self:o})=>{const a=o._parent?.input||{};return e.type==="DELETE_GROUP"?{...a,groupId:e.groupId}:a},onDone:{target:"ready",actions:v({groups:({context:e,event:o})=>e.groups.filter(a=>a.id!==o.output)})},onError:{target:"error",actions:v({error:({event:e})=>e.error.message})}},on:{GROUP_DELETED:{target:"ready",actions:"removeGroup"},OPERATION_FAILED:{target:"error",actions:"setError"}}},error:{on:{LOAD_GROUPS:{target:"loading",actions:"clearError"},CREATE_GROUP:{target:"editing",actions:["clearError","clearCurrentGroup"]}}}}});function ue(){const e=f(null),o=f("idle"),a=f([]),s=f(null),p=f([]),l=f([]),G=f(null),h=f(!1),T=g(()=>o.value==="idle"),k=g(()=>o.value==="loading"),b=g(()=>o.value==="ready"),D=g(()=>o.value==="editing"),I=g(()=>o.value==="saving"),P=g(()=>o.value==="deleting"),A=g(()=>o.value==="error"),O=g(()=>a.value.length>0),R=g(()=>D.value&&s.value===null),U=g(()=>D.value&&s.value!==null);W(()=>{e.value=X(le),e.value.subscribe(c=>{o.value=c.value,a.value=c.context.groups,s.value=c.context.currentGroup,p.value=c.context.availableLights,l.value=c.context.selectedLights,G.value=c.context.error,h.value=c.context.isLoading}),e.value.start()}),Y(()=>{e.value&&e.value.stop()});const w=()=>{e.value&&e.value.send({type:"LOAD_GROUPS"})},V=()=>{e.value&&e.value.send({type:"CREATE_GROUP"})},x=c=>{e.value&&e.value.send({type:"EDIT_GROUP",group:c})},N=(c,J)=>{e.value&&e.value.send({type:"SAVE_GROUP",name:c,selectedLights:J})},m=c=>{e.value&&e.value.send({type:"DELETE_GROUP",groupId:c})},t=()=>{e.value&&e.value.send({type:"CANCEL_EDIT"})},i=c=>{e.value&&e.value.send({type:"SELECT_LIGHT",lightId:c})},M=c=>{e.value&&e.value.send({type:"DESELECT_LIGHT",lightId:c})},q=c=>{l.value.includes(c)?M(c):i(c)},z=c=>g(()=>l.value.includes(c));return{state:g(()=>o.value),groups:g(()=>a.value),currentGroup:g(()=>s.value),availableLights:g(()=>p.value),selectedLights:g(()=>l.value),error:g(()=>G.value),isLoading:g(()=>h.value),isIdle:T,isLoadingGroups:k,isReady:b,isEditing:D,isSaving:I,isDeleting:P,hasError:A,hasGroups:O,isCreatingNew:R,isEditingExisting:U,loadGroups:w,createGroup:V,editGroup:x,saveGroup:N,deleteGroup:m,cancelEdit:t,selectLight:i,deselectLight:M,toggleLightSelection:q,isLightSelected:z}}const de={class:"group-control-view"},pe={class:"config-section","data-testid":"api-key-section"},ce={class:"form-group"},ge={class:"input-group"},ve=["disabled"],ye=["disabled"],fe={key:0},me={key:1},Ge={key:0,class:"status-message status-loading"},Ee={key:1,class:"status-message status-success"},be={key:2,class:"status-message status-error"},Le={class:"config-section","data-testid":"group-management-section"},he={key:0,class:"form-group"},_e=["disabled"],Ce={key:1,class:"status-message status-loading"},ke={key:2,class:"status-message status-error"},Ie={key:3,class:"form-group"},Te={class:"form-group"},De=["disabled"],Pe={value:"",disabled:""},Se=["value"],Ae={class:"group-actions"},Oe=["disabled"],Re=["disabled"],Ue={key:0},we={key:1},Ve=["disabled"],xe={key:0,class:"config-section","data-testid":"group-creation-form"},Ne={key:0,class:"status-message status-loading"},Me={key:1},Fe={class:"form-group"},Ke=["disabled"],He={class:"form-group"},Be={key:0,class:"status-message status-loading"},We={key:1,class:"status-message status-loading"},$e={key:2,class:"status-message status-error"},qe={key:3,class:"light-selection"},ze=["id","checked","onChange"],Je=["for"],Qe={key:4,class:"status-message status-error"},Xe={class:"form-actions"},Ye=["disabled"],Ze=["disabled"],je={class:"config-section","data-testid":"control-mode-section"},et={class:"form-group"},tt={key:0,class:"form-group"},ot={class:"range-value"},st={key:1,class:"form-group"},rt={key:2,class:"form-group"},nt={class:"range-value"},at=Z({__name:"GroupControlView",setup(e){const o=j(),a=ee(),s=ue(),p=f(""),l=f(""),G=f("toggle"),h=f(100),T=f("#ffffff"),k=f(6500),b=f(""),D=g(()=>s.isCreatingNew.value),I=g(()=>s.isEditingExisting.value),P=g(()=>s.selectedLights.value),A=()=>{p.value&&o.connect(p.value)},O=()=>{const m=s.groups.value.find(t=>t.id===l.value);m&&(s.editGroup(m),b.value=m.name)},R=()=>{l.value&&confirm("Are you sure you want to delete this group?")&&(s.deleteGroup(l.value),l.value="")},U=()=>{b.value&&P.value.length>0&&(s.saveGroup(b.value,P.value),b.value="")},w=()=>{s.cancelEdit(),b.value=""},V=()=>{s.createGroup(),b.value=""},x=m=>{s.toggleLightSelection(m)},N=m=>s.isLightSelected(m).value;return te(()=>o.isConnected.value,m=>{m&&(a.isIdle.value&&a.fetchLights(),s.isIdle.value&&s.loadGroups())}),W(()=>{o.isConnected.value&&s.isIdle.value&&s.loadGroups()}),g(()=>({apiKey:o.apiKey.value||void 0,selectedGroupId:l.value||void 0,controlMode:G.value,brightnessValue:G.value==="brightness"?h.value:void 0,colorValue:G.value==="color"?T.value:void 0,colorTempValue:G.value==="colorTemp"?k.value:void 0})),(m,t)=>(d(),u("div",de,[r("section",pe,[t[17]||(t[17]=r("h2",null,"API Configuration",-1)),r("div",ce,[t[15]||(t[15]=r("label",{for:"apiKey"},"API Key",-1)),r("div",ge,[C(r("input",{id:"apiKey","onUpdate:modelValue":t[0]||(t[0]=i=>p.value=i),type:"password",class:"form-input",placeholder:"Enter your Govee API key",autocomplete:"off",disabled:n(o).isConnecting,onKeyup:oe(A,["enter"])},null,40,ve),[[S,p.value]]),n(o).isDisconnected||n(o).hasError?(d(),u("button",{key:0,class:"btn btn-primary",disabled:!p.value||n(o).isConnecting,onClick:A},[n(o).isConnecting?(d(),u("span",fe,"Connecting...")):(d(),u("span",me,"Connect"))],8,ye)):n(o).isConnected?(d(),u("button",{key:1,class:"btn btn-secondary",onClick:t[1]||(t[1]=(...i)=>n(o).disconnect&&n(o).disconnect(...i))}," Disconnect ")):_("",!0)]),n(o).isConnecting?(d(),u("div",Ge,t[12]||(t[12]=[r("span",{class:"status-icon"},"⏳",-1),L(" Validating API key... ",-1)]))):n(o).isConnected?(d(),u("div",Ee,t[13]||(t[13]=[r("span",{class:"status-icon"},"✅",-1),L(" API key validated successfully ",-1)]))):n(o).hasError?(d(),u("div",be,[t[14]||(t[14]=r("span",{class:"status-icon"},"❌",-1)),L(" "+E(n(o).error)+" ",1),r("button",{class:"btn-link",onClick:t[2]||(t[2]=(...i)=>n(o).retry&&n(o).retry(...i))},"Retry")])):_("",!0),t[16]||(t[16]=r("small",{class:"help-text"}," Get your API key from the Govee Home app → Settings → About Us → Apply for API Key ",-1))])]),r("section",Le,[t[22]||(t[22]=r("h2",null,"Group Management",-1)),n(s).isIdle?(d(),u("div",he,[r("button",{class:"btn btn-primary",disabled:!n(o).isConnected,onClick:t[3]||(t[3]=(...i)=>n(s).loadGroups&&n(s).loadGroups(...i))}," Load Groups ",8,_e),t[18]||(t[18]=r("small",{class:"help-text"}," Connect your API key first, then load your light groups ",-1))])):n(s).isLoadingGroups?(d(),u("div",Ce,t[19]||(t[19]=[r("span",{class:"status-icon"},"⏳",-1),L(" Loading groups... ",-1)]))):n(s).hasError?(d(),u("div",ke,[t[20]||(t[20]=r("span",{class:"status-icon"},"❌",-1)),L(" "+E(n(s).error)+" ",1),r("button",{class:"btn-link",onClick:t[4]||(t[4]=(...i)=>n(s).loadGroups&&n(s).loadGroups(...i))},"Retry")])):n(s).isReady?(d(),u("div",Ie,[r("div",Te,[t[21]||(t[21]=r("label",{for:"groupSelect"},"Light Group",-1)),C(r("select",{id:"groupSelect","onUpdate:modelValue":t[5]||(t[5]=i=>l.value=i),class:"form-select",disabled:!n(s).hasGroups},[r("option",Pe,E(n(s).hasGroups?"Select a light group...":"No groups found"),1),(d(!0),u(H,null,B(n(s).groups,i=>(d(),u("option",{key:i.id,value:i.id},E(i.name)+" ("+E(i.lightIds.length)+" lights) ",9,Se))),128))],8,De),[[K,l.value]])]),r("div",Ae,[r("button",{type:"button",class:"btn btn-secondary",disabled:!l.value||n(s).isLoading,onClick:O}," ✏️ Edit ",8,Oe),r("button",{type:"button",class:"btn btn-danger",disabled:!l.value||n(s).isLoading,onClick:R},[n(s).isDeleting?(d(),u("span",Ue,"Deleting...")):(d(),u("span",we,"🗑️ Delete"))],8,Re),r("button",{type:"button",class:"btn btn-primary",disabled:n(s).isLoading,onClick:V}," + Create New Group ",8,Ve)])])):_("",!0)]),D.value||I.value?(d(),u("section",xe,[r("h2",null,E(I.value?"Edit Group":"Create New Group"),1),n(s).isSaving?(d(),u("div",Ne,[t[23]||(t[23]=r("span",{class:"status-icon"},"⏳",-1)),L(" "+E(I.value?"Updating group...":"Creating group..."),1)])):(d(),u("div",Me,[r("div",Fe,[t[24]||(t[24]=r("label",{for:"groupName"},"Group Name",-1)),C(r("input",{id:"groupName","onUpdate:modelValue":t[6]||(t[6]=i=>b.value=i),type:"text",class:"form-input",placeholder:"Enter group name",disabled:n(s).isLoading},null,8,Ke),[[S,b.value]])]),r("div",He,[t[29]||(t[29]=r("label",null,"Select Lights",-1)),n(a).isIdle?(d(),u("div",Be,t[25]||(t[25]=[r("span",{class:"status-icon"},"⏳",-1),L(" Loading available lights... ",-1)]))):n(a).isFetchingLights?(d(),u("div",We,t[26]||(t[26]=[r("span",{class:"status-icon"},"⏳",-1),L(" Discovering lights... ",-1)]))):n(a).hasError?(d(),u("div",$e,[t[27]||(t[27]=r("span",{class:"status-icon"},"❌",-1)),L(" "+E(n(a).error)+" ",1),r("button",{class:"btn-link",onClick:t[7]||(t[7]=(...i)=>n(a).retryFetch&&n(a).retryFetch(...i))},"Retry")])):n(a).isReady&&n(a).hasLights?(d(),u("div",qe,[(d(!0),u(H,null,B(n(a).lights,i=>(d(),u("div",{key:i.value,class:"light-checkbox"},[r("input",{id:`light-${i.value}`,checked:N(i.value),type:"checkbox",class:"checkbox",onChange:M=>x(i.value)},null,40,ze),r("label",{for:`light-${i.value}`,class:"checkbox-label"},E(i.label),9,Je)]))),128))])):(d(),u("div",Qe,t[28]||(t[28]=[r("span",{class:"status-icon"},"ℹ️",-1),L(" No lights available. Make sure your API key is connected and lights are discoverable. ",-1)])))]),r("div",Xe,[r("button",{type:"button",class:"btn btn-secondary",disabled:n(s).isLoading,onClick:w}," Cancel ",8,Ye),r("button",{type:"button",class:"btn btn-primary",disabled:!b.value||P.value.length===0||n(s).isLoading,onClick:U},E(I.value?"Update Group":"Create Group"),9,Ze)])]))])):_("",!0),r("section",je,[t[35]||(t[35]=r("h2",null,"Control Mode",-1)),r("div",et,[t[31]||(t[31]=r("label",{for:"controlMode"},"Control Mode",-1)),C(r("select",{id:"controlMode","onUpdate:modelValue":t[8]||(t[8]=i=>G.value=i),class:"form-select"},t[30]||(t[30]=[se('<option value="toggle" data-v-0197973d>Toggle On/Off</option><option value="on" data-v-0197973d>Turn On</option><option value="off" data-v-0197973d>Turn Off</option><option value="brightness" data-v-0197973d>Set Brightness</option><option value="color" data-v-0197973d>Set Color</option><option value="colorTemp" data-v-0197973d>Set Color Temperature</option>',6)]),512),[[K,G.value]])]),G.value==="brightness"?(d(),u("div",tt,[t[32]||(t[32]=r("label",{for:"brightness"},"Brightness (%)",-1)),C(r("input",{id:"brightness","onUpdate:modelValue":t[9]||(t[9]=i=>h.value=i),type:"range",min:"1",max:"100",class:"form-range"},null,512),[[S,h.value,void 0,{number:!0}]]),r("span",ot,E(h.value)+"%",1)])):_("",!0),G.value==="color"?(d(),u("div",st,[t[33]||(t[33]=r("label",{for:"color"},"Color",-1)),C(r("input",{id:"color","onUpdate:modelValue":t[10]||(t[10]=i=>T.value=i),type:"color",class:"form-color"},null,512),[[S,T.value]])])):_("",!0),G.value==="colorTemp"?(d(),u("div",rt,[t[34]||(t[34]=r("label",{for:"colorTemp"},"Color Temperature (K)",-1)),C(r("input",{id:"colorTemp","onUpdate:modelValue":t[11]||(t[11]=i=>k.value=i),type:"range",min:"2000",max:"9000",step:"100",class:"form-range"},null,512),[[S,k.value,void 0,{number:!0}]]),r("span",nt,E(k.value)+"K",1)])):_("",!0)])]))}}),it=re(at,[["__scopeId","data-v-0197973d"]]);ne();const $=ae(ie);$.component("main-view",it);$.mount("#app");
//# sourceMappingURL=group-control.js.map
