import{B as te,C as y,D as W,b as f,r as b,c as g,o as Z,E as oe,e as j,d as se,u as re,a as ne,w as E,f as d,g as c,h as r,i as C,j as I,v as R,k as ae,l,m as L,t as m,n as ie,F as J,p as Q,s as Y,x as le,q as ue,_ as de,y as ce,z as pe,A as ge}from"./propertyInspectorInit.js";import{b as ve,a as fe,D as ye}from"./DiagnosticsPanel.js";const me=te({actions:{setGroups:y({groups:({event:t})=>t.type==="GROUPS_LOADED"?t.groups:[]}),setCurrentGroup:y({currentGroup:({event:t})=>t.type==="EDIT_GROUP"?t.group:null}),clearCurrentGroup:y({currentGroup:null,selectedLights:[]}),selectLight:y({selectedLights:({context:t,event:s})=>s.type==="SELECT_LIGHT"&&!t.selectedLights.includes(s.lightId)?[...t.selectedLights,s.lightId]:t.selectedLights}),deselectLight:y({selectedLights:({context:t,event:s})=>s.type==="DESELECT_LIGHT"?t.selectedLights.filter(i=>i!==s.lightId):t.selectedLights}),addOrUpdateGroup:y({groups:({context:t,event:s})=>{if(s.type==="GROUP_SAVED"){const i=t.groups.findIndex(o=>o.id===s.group.id);if(i>=0){const o=[...t.groups];return o[i]=s.group,o}else return[...t.groups,s.group]}return t.groups}}),removeGroup:y({groups:({context:t,event:s})=>s.type==="GROUP_DELETED"?t.groups.filter(i=>i.id!==s.groupId):t.groups}),setError:y({error:({event:t})=>t.type==="OPERATION_FAILED"?t.error:null}),clearError:y({error:null}),startLoading:y({isLoading:!0}),stopLoading:y({isLoading:!1})},actors:{loadGroups:W(async({input:t})=>{if(!f.isConnected)throw new Error("WebSocket not connected to Stream Deck");return new Promise((s,i)=>{const o=setTimeout(()=>{f.off("sendToPropertyInspector",u),i(new Error("Group loading timeout"))},1e4),u=p=>{p.payload?.event==="groupsReceived"&&(clearTimeout(o),f.off("sendToPropertyInspector",u),p.payload.error?i(new Error(p.payload.error)):s(p.payload.groups||[]))};f.on("sendToPropertyInspector",u),f.requestGroups()})}),saveGroup:W(async({input:t})=>{if(!f.isConnected)throw new Error("WebSocket not connected to Stream Deck");return new Promise((s,i)=>{const o=setTimeout(()=>{f.off("sendToPropertyInspector",u),i(new Error("Group save timeout"))},1e4),u=p=>{p.payload?.event==="groupSaved"&&(clearTimeout(o),f.off("sendToPropertyInspector",u),p.payload.error?i(new Error(p.payload.error)):s(p.payload.group))};f.on("sendToPropertyInspector",u),f.saveGroup({name:t.name,lightIds:t.selectedLights})})}),deleteGroup:W(async({input:t})=>{if(!f.isConnected)throw new Error("WebSocket not connected to Stream Deck");return new Promise((s,i)=>{const o=setTimeout(()=>{f.off("sendToPropertyInspector",u),i(new Error("Group delete timeout"))},1e4),u=p=>{p.payload?.event==="groupDeleted"&&(clearTimeout(o),f.off("sendToPropertyInspector",u),p.payload.error?i(new Error(p.payload.error)):s(p.payload.groupId))};f.on("sendToPropertyInspector",u),f.deleteGroup(t.groupId)})})}}).createMachine({id:"groupManagement",initial:"idle",context:({input:t})=>({groups:[],currentGroup:null,availableLights:[],selectedLights:[],error:null,isLoading:!1}),states:{idle:{on:{LOAD_GROUPS:{target:"loading"}}},loading:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"loadGroups",input:()=>({}),onDone:{target:"ready",actions:y({groups:({event:t})=>t.output})},onError:{target:"error",actions:y({error:({event:t})=>t.error?.message||"Unknown error"})}},on:{GROUPS_LOADED:{target:"ready",actions:"setGroups"},OPERATION_FAILED:{target:"error",actions:"setError"}}},ready:{on:{CREATE_GROUP:{target:"editing",actions:"clearCurrentGroup"},EDIT_GROUP:{target:"editing",actions:["setCurrentGroup",y({selectedLights:({event:t})=>t.type==="EDIT_GROUP"?t.group.lightIds||[]:[]})]},DELETE_GROUP:{target:"deleting"},LOAD_GROUPS:{target:"loading"}}},editing:{on:{SAVE_GROUP:{target:"saving"},CANCEL_EDIT:{target:"ready",actions:"clearCurrentGroup"},SELECT_LIGHT:{actions:"selectLight"},DESELECT_LIGHT:{actions:"deselectLight"}}},saving:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"saveGroup",input:({context:t,event:s,self:i})=>s.type==="SAVE_GROUP"?{name:s.name,selectedLights:s.selectedLights,groupId:t.currentGroup?.id}:{name:"",selectedLights:[]},onDone:{target:"ready",actions:[y({groups:({context:t,event:s})=>{const i=s.output,o=t.groups.findIndex(u=>u.id===i.id);if(o>=0){const u=[...t.groups];return u[o]=i,u}else return[...t.groups,i]}}),"clearCurrentGroup"]},onError:{target:"error",actions:y({error:({event:t})=>t.error?.message||"Unknown error"})}},on:{GROUP_SAVED:{target:"ready",actions:["addOrUpdateGroup","clearCurrentGroup"]},OPERATION_FAILED:{target:"error",actions:"setError"}}},deleting:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"deleteGroup",input:({event:t,self:s})=>t.type==="DELETE_GROUP"?{groupId:t.groupId}:{groupId:""},onDone:{target:"ready",actions:y({groups:({context:t,event:s})=>t.groups.filter(i=>i.id!==s.output)})},onError:{target:"error",actions:y({error:({event:t})=>t.error?.message||"Unknown error"})}},on:{GROUP_DELETED:{target:"ready",actions:"removeGroup"},OPERATION_FAILED:{target:"error",actions:"setError"}}},error:{on:{LOAD_GROUPS:{target:"loading",actions:"clearError"},CREATE_GROUP:{target:"editing",actions:["clearError","clearCurrentGroup"]}}}}});function he(){const t=b(null),s=b("idle"),i=b([]),o=b(null),u=b([]),p=b([]),S=b(null),P=b(!1),M=g(()=>s.value==="idle"),H=g(()=>s.value==="loading"),F=g(()=>s.value==="ready"),_=g(()=>s.value==="editing"),h=g(()=>s.value==="saving"),K=g(()=>s.value==="deleting"),D=g(()=>s.value==="error"),A=g(()=>i.value.length>0),k=g(()=>_.value&&o.value===null),G=g(()=>_.value&&o.value!==null);Z(()=>{t.value=oe(me,{input:{}}),t.value.subscribe(v=>{s.value=v.value,i.value=v.context.groups,o.value=v.context.currentGroup,u.value=v.context.availableLights,p.value=v.context.selectedLights,S.value=v.context.error,P.value=v.context.isLoading}),t.value.start()}),j(()=>{t.value&&t.value.stop()});const T=()=>{t.value&&t.value.send({type:"LOAD_GROUPS"})},w=()=>{t.value&&t.value.send({type:"CREATE_GROUP"})},U=v=>{t.value&&t.value.send({type:"EDIT_GROUP",group:v})},O=(v,z)=>{t.value&&t.value.send({type:"SAVE_GROUP",name:v,selectedLights:z})},V=v=>{t.value&&t.value.send({type:"DELETE_GROUP",groupId:v})},$=()=>{t.value&&t.value.send({type:"CANCEL_EDIT"})},N=v=>{t.value&&t.value.send({type:"SELECT_LIGHT",lightId:v})},x=v=>{t.value&&t.value.send({type:"DESELECT_LIGHT",lightId:v})},B=v=>{p.value.includes(v)?x(v):N(v)},q=v=>g(()=>p.value.includes(v));return{state:g(()=>s.value),groups:g(()=>i.value),currentGroup:g(()=>o.value),availableLights:g(()=>u.value),selectedLights:g(()=>p.value),error:g(()=>S.value),isLoading:g(()=>P.value),isIdle:M,isLoadingGroups:H,isReady:F,isEditing:_,isSaving:h,isDeleting:K,hasError:D,hasGroups:A,isCreatingNew:k,isEditingExisting:G,loadGroups:T,createGroup:w,editGroup:U,saveGroup:O,deleteGroup:V,cancelEdit:$,selectLight:N,deselectLight:x,toggleLightSelection:B,isLightSelected:q}}const Ge={class:"group-control-view"},Ee={class:"config-section","data-testid":"api-key-section"},Le={class:"form-group"},be={class:"input-group"},_e=["disabled"],Ce=["disabled"],ke={key:0},Te={key:1},Ie={key:0,class:"status-message status-loading"},Se={key:1,class:"status-message status-success"},De={key:2,class:"status-message status-error"},Pe={class:"config-section diagnostics-section"},Ae={key:0,class:"transport-health"},we={class:"transport-label"},Oe={key:0},Re={class:"config-section","data-testid":"group-management-section"},Ue={key:0,class:"form-group"},Ve=["disabled"],Ne={key:1,class:"status-message status-loading"},xe={key:2,class:"status-message status-error"},Me={key:3,class:"form-group"},He={class:"form-group"},Fe=["disabled"],Ke={value:"",disabled:""},$e=["value"],Be={class:"group-actions"},qe=["disabled"],ze=["disabled"],We={key:0},Je={key:1},Qe=["disabled"],Xe={key:0,class:"config-section","data-testid":"group-creation-form"},Ye={key:0,class:"status-message status-loading"},Ze={key:1},je={class:"form-group"},et=["disabled"],tt={class:"form-group"},ot={key:0,class:"status-message status-loading"},st={key:1,class:"status-message status-loading"},rt={key:2,class:"status-message status-error"},nt={key:3,class:"light-selection"},at=["id","checked","onChange"],it=["for"],lt={key:4,class:"status-message status-error"},ut={class:"form-actions"},dt=["disabled"],ct=["disabled"],pt={class:"config-section","data-testid":"control-mode-section"},gt={class:"form-group"},vt={key:0,class:"form-group"},ft={class:"range-value"},yt={key:1,class:"form-group"},mt={key:2,class:"form-group"},ht={class:"range-value"},Gt=se({__name:"GroupControlView",setup(t){const s=re(),i=ne(),o=he(),u=ve(),p=fe(),S=b([]),P=b(null),M=()=>{f.requestTransportHealth()},H=()=>{f.requestTelemetrySnapshot()},F=()=>{f.resetTelemetry()},_=()=>{M(),H()},h=b(""),K=g(()=>o.isCreatingNew.value),D=g(()=>o.isEditingExisting.value),A=g(()=>o.selectedLights.value),k=g({get:()=>u.settings.apiKey||"",set:n=>u.updateSetting("apiKey",n||void 0)}),G=g({get:()=>u.settings.selectedGroupId||"",set:n=>{if(u.updateSetting("selectedGroupId",n||void 0),n){const e=o.groups.value.find(a=>a.id===n);e&&u.updateSetting("selectedGroupName",e.name)}else u.updateSetting("selectedGroupName",void 0)}}),T=g({get:()=>u.settings.controlMode||"toggle",set:n=>u.updateSetting("controlMode",n)}),w=g({get:()=>u.settings.brightnessValue||100,set:n=>u.updateSetting("brightnessValue",n)}),U=g({get:()=>u.settings.colorValue||"#ffffff",set:n=>u.updateSetting("colorValue",n)}),O=g({get:()=>u.settings.colorTempValue||6500,set:n=>u.updateSetting("colorTempValue",n)}),V=()=>{k.value&&(p.showInfo("Connecting to API","Validating your API key..."),s.connect(k.value))},$=()=>{const n=o.groups.value.find(e=>e.id===G.value);n&&(o.editGroup(n),h.value=n.name)},N=()=>{G.value&&window.confirm("Are you sure you want to delete this group?")&&(o.deleteGroup(G.value),G.value="")},x=()=>{h.value&&A.value.length>0&&(o.saveGroup(h.value,A.value),h.value="")},B=()=>{o.cancelEdit(),h.value=""},q=()=>{o.createGroup(),h.value=""},v=n=>{o.toggleLightSelection(n)},z=n=>o.isLightSelected(n).value;return E(()=>s.isConnected.value,(n,e)=>{n&&!e&&(p.showSuccessToast("API Connected","Successfully connected to Govee API"),i.isIdle.value?i.fetchLights():i.refreshLights(),o.isIdle.value&&o.loadGroups(),_())}),E(()=>u.settings.apiKey,n=>{n&&!s.isConnected.value&&s.connect(n)}),E(()=>s.error.value,n=>{n&&p.showApiError({message:n},"API Connection Failed")}),E(()=>i.isReady.value,(n,e)=>{if(n&&!e&&i.hasLights.value){const a=i.lights.value.length;p.showSuccessToast("Lights Discovered",`Found ${a} light${a===1?"":"s"}`)}}),E(()=>i.error.value,n=>{n&&p.showApiError({message:n},"Light Discovery Failed")}),E(()=>o.isReady.value,(n,e)=>{if(n&&!e){const a=o.groups.value.length;p.showSuccessToast("Groups Loaded",a?`Loaded ${a} group${a===1?"":"s"}`:"No groups configured yet")}}),E(()=>o.error.value,n=>{n&&p.showApiError({message:n},"Group Operation Failed")}),E(()=>o.isSaving.value,(n,e)=>{!n&&e&&!o.hasError.value&&(p.showSuccessToast("Group Saved","Group changes saved successfully"),_())}),E(()=>o.isDeleting.value,(n,e)=>{!n&&e&&!o.hasError.value&&(p.showSuccessToast("Group Deleted","Group removed successfully"),_())}),E(()=>o.groups.value,n=>{if(G.value){const e=n.find(X=>X.id===G.value),a=e?.name||void 0;u.settings.selectedGroupName!==a&&u.updateSetting("selectedGroupName",a),e||(G.value="")}},{deep:!0}),E(()=>o.currentGroup.value,n=>{n?h.value=n.name:o.isEditing.value||(h.value="")}),E(()=>o.isEditing.value,n=>{n&&i.isIdle.value&&i.fetchLights()}),Z(()=>{u.enableAutoSave(500),u.loadSettings(),u.settings.apiKey&&s.connect(u.settings.apiKey),s.isConnected.value&&(o.isIdle.value&&o.loadGroups(),_());const n=e=>{e.payload?.event==="transportHealth"&&(S.value=e.payload.transports??[]),e.payload?.event==="telemetrySnapshot"&&(P.value=e.payload.snapshot??null)};f.on("sendToPropertyInspector",n),j(()=>{f.off("sendToPropertyInspector",n)})}),(n,e)=>(c(),d("div",Ge,[r("section",Ee,[e[17]||(e[17]=r("h2",null,"API Configuration",-1)),r("div",Le,[e[15]||(e[15]=r("label",{for:"apiKey"},"API Key",-1)),r("div",be,[I(r("input",{id:"apiKey","onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a),type:"password",class:"form-input",placeholder:"Enter your Govee API key",autocomplete:"off",disabled:l(s).isConnecting.value,onKeyup:ae(V,["enter"])},null,40,_e),[[R,k.value]]),l(s).isDisconnected||l(s).hasError?(c(),d("button",{key:0,class:"btn btn-primary",disabled:!k.value||l(s).isConnecting.value,onClick:V},[l(s).isConnecting?(c(),d("span",ke,"Connecting...")):(c(),d("span",Te,"Connect"))],8,Ce)):l(s).isConnected?(c(),d("button",{key:1,class:"btn btn-secondary",onClick:e[1]||(e[1]=(...a)=>l(s).disconnect&&l(s).disconnect(...a))}," Disconnect ")):C("",!0)]),l(s).isConnecting?(c(),d("div",Ie,[...e[12]||(e[12]=[r("span",{class:"status-icon"},"⏳",-1),L(" Validating API key... ",-1)])])):l(s).isConnected?(c(),d("div",Se,[...e[13]||(e[13]=[r("span",{class:"status-icon"},"✅",-1),L(" API key validated successfully ",-1)])])):l(s).hasError?(c(),d("div",De,[e[14]||(e[14]=r("span",{class:"status-icon"},"❌",-1)),L(" "+m(l(s).error)+" ",1),r("button",{class:"btn-link",onClick:e[2]||(e[2]=(...a)=>l(s).retry&&l(s).retry(...a))},"Retry")])):C("",!0),e[16]||(e[16]=r("small",{class:"help-text"}," Get your API key from the Govee Home app → Settings → About Us → Apply for API Key ",-1))])]),r("section",Pe,[e[18]||(e[18]=r("h2",null,"Connectivity Diagnostics",-1)),S.value.length?(c(),d("div",Ae,[r("ul",null,[(c(!0),d(J,null,Q(S.value,a=>(c(),d("li",{key:a.kind},[r("span",we,m(a.label),1),r("span",{class:ue(["transport-indicator",{healthy:a.isHealthy,unhealthy:!a.isHealthy}])},[L(m(a.isHealthy?"Available":"Unavailable")+" ",1),a.latencyMs!==void 0?(c(),d("span",Oe," • "+m(a.latencyMs)+" ms ",1)):C("",!0)],2)]))),128))])])):C("",!0),ie(ye,{snapshot:P.value,onRefresh:_,onReset:F},null,8,["snapshot"])]),r("section",Re,[e[23]||(e[23]=r("h2",null,"Group Management",-1)),l(o).isIdle?(c(),d("div",Ue,[r("button",{class:"btn btn-primary",disabled:!l(s).isConnected,onClick:e[3]||(e[3]=(...a)=>l(o).loadGroups&&l(o).loadGroups(...a))}," Load Groups ",8,Ve),e[19]||(e[19]=r("small",{class:"help-text"}," Connect your API key first, then load your light groups ",-1))])):l(o).isLoadingGroups?(c(),d("div",Ne,[...e[20]||(e[20]=[r("span",{class:"status-icon"},"⏳",-1),L(" Loading groups... ",-1)])])):l(o).hasError?(c(),d("div",xe,[e[21]||(e[21]=r("span",{class:"status-icon"},"❌",-1)),L(" "+m(l(o).error)+" ",1),r("button",{class:"btn-link",onClick:e[4]||(e[4]=(...a)=>l(o).loadGroups&&l(o).loadGroups(...a))}," Retry ")])):l(o).isReady?(c(),d("div",Me,[r("div",He,[e[22]||(e[22]=r("label",{for:"groupSelect"},"Light Group",-1)),I(r("select",{id:"groupSelect","onUpdate:modelValue":e[5]||(e[5]=a=>G.value=a),class:"form-select",disabled:!l(o).hasGroups},[r("option",Ke,m(l(o).hasGroups?"Select a light group...":"No groups found"),1),(c(!0),d(J,null,Q(l(o).groups.value,a=>(c(),d("option",{key:a.id,value:a.id},m(a.name)+" ("+m(a.lightIds?.length||0)+" lights) ",9,$e))),128))],8,Fe),[[Y,G.value]])]),r("div",Be,[r("button",{type:"button",class:"btn btn-secondary",disabled:!G.value||l(o).isLoading.value,onClick:$}," ✏️ Edit ",8,qe),r("button",{type:"button",class:"btn btn-danger",disabled:!G.value||l(o).isLoading.value,onClick:N},[l(o).isDeleting?(c(),d("span",We,"Deleting...")):(c(),d("span",Je,"🗑️ Delete"))],8,ze),r("button",{type:"button",class:"btn btn-primary",disabled:l(o).isLoading.value,onClick:q}," + Create New Group ",8,Qe)])])):C("",!0)]),K.value||D.value?(c(),d("section",Xe,[r("h2",null,m(D.value?"Edit Group":"Create New Group"),1),l(o).isSaving?(c(),d("div",Ye,[e[24]||(e[24]=r("span",{class:"status-icon"},"⏳",-1)),L(" "+m(D.value?"Updating group...":"Creating group..."),1)])):(c(),d("div",Ze,[r("div",je,[e[25]||(e[25]=r("label",{for:"groupName"},"Group Name",-1)),I(r("input",{id:"groupName","onUpdate:modelValue":e[6]||(e[6]=a=>h.value=a),type:"text",class:"form-input",placeholder:"Enter group name",disabled:l(o).isLoading.value},null,8,et),[[R,h.value]])]),r("div",tt,[e[30]||(e[30]=r("label",null,"Select Lights",-1)),l(i).isIdle?(c(),d("div",ot,[...e[26]||(e[26]=[r("span",{class:"status-icon"},"⏳",-1),L(" Loading available lights... ",-1)])])):l(i).isFetchingLights?(c(),d("div",st,[...e[27]||(e[27]=[r("span",{class:"status-icon"},"⏳",-1),L(" Discovering lights... ",-1)])])):l(i).hasError?(c(),d("div",rt,[e[28]||(e[28]=r("span",{class:"status-icon"},"❌",-1)),L(" "+m(l(i).error)+" ",1),r("button",{class:"btn-link",onClick:e[7]||(e[7]=(...a)=>l(i).retryFetch&&l(i).retryFetch(...a))}," Retry ")])):l(i).isReady&&l(i).hasLights?(c(),d("div",nt,[(c(!0),d(J,null,Q(l(i).lights.value,a=>(c(),d("div",{key:a.value,class:"light-checkbox"},[r("input",{id:`light-${a.value}`,checked:z(a.value),type:"checkbox",class:"checkbox",onChange:X=>v(a.value)},null,40,at),r("label",{for:`light-${a.value}`,class:"checkbox-label"},m(a.label),9,it)]))),128))])):(c(),d("div",lt,[...e[29]||(e[29]=[r("span",{class:"status-icon"},"ℹ️",-1),L(" No lights available. Make sure your API key is connected and lights are discoverable. ",-1)])]))]),r("div",ut,[r("button",{type:"button",class:"btn btn-secondary",disabled:l(o).isLoading.value,onClick:B}," Cancel ",8,dt),r("button",{type:"button",class:"btn btn-primary",disabled:!h.value||A.value.length===0||l(o).isLoading.value,onClick:x},m(D.value?"Update Group":"Create Group"),9,ct)])]))])):C("",!0),r("section",pt,[e[36]||(e[36]=r("h2",null,"Control Mode",-1)),r("div",gt,[e[32]||(e[32]=r("label",{for:"controlMode"},"Control Mode",-1)),I(r("select",{id:"controlMode","onUpdate:modelValue":e[8]||(e[8]=a=>T.value=a),class:"form-select"},[...e[31]||(e[31]=[le('<option value="toggle" data-v-043e0f3c>Toggle On/Off</option><option value="on" data-v-043e0f3c>Turn On</option><option value="off" data-v-043e0f3c>Turn Off</option><option value="brightness" data-v-043e0f3c>Set Brightness</option><option value="color" data-v-043e0f3c>Set Color</option><option value="colorTemp" data-v-043e0f3c>Set Color Temperature</option>',6)])],512),[[Y,T.value]])]),T.value==="brightness"?(c(),d("div",vt,[e[33]||(e[33]=r("label",{for:"brightness"},"Brightness (%)",-1)),I(r("input",{id:"brightness","onUpdate:modelValue":e[9]||(e[9]=a=>w.value=a),type:"range",min:"1",max:"100",class:"form-range"},null,512),[[R,w.value,void 0,{number:!0}]]),r("span",ft,m(w.value)+"%",1)])):C("",!0),T.value==="color"?(c(),d("div",yt,[e[34]||(e[34]=r("label",{for:"color"},"Color",-1)),I(r("input",{id:"color","onUpdate:modelValue":e[10]||(e[10]=a=>U.value=a),type:"color",class:"form-color"},null,512),[[R,U.value]])])):C("",!0),T.value==="colorTemp"?(c(),d("div",mt,[e[35]||(e[35]=r("label",{for:"colorTemp"},"Color Temperature (K)",-1)),I(r("input",{id:"colorTemp","onUpdate:modelValue":e[11]||(e[11]=a=>O.value=a),type:"range",min:"2000",max:"9000",step:"100",class:"form-range"},null,512),[[R,O.value,void 0,{number:!0}]]),r("span",ht,m(O.value)+"K",1)])):C("",!0)])]))}}),Et=de(Gt,[["__scopeId","data-v-043e0f3c"]]);ce();const ee=pe(ge);ee.component("main-view",Et);ee.mount("#app");
//# sourceMappingURL=group-control.js.map
