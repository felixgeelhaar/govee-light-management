import{D as te,E as y,G as z,e as f,r as L,c,o as j,H as oe,f as ee,d as se,u as re,a as ne,b as ae,w as E,g as p,h as g,i as X,j as n,k as S,A as le,F as W,l as J,t as m,n as ie,m as _,p as u,q as k,s as Y,v as N,x as ue,_ as de,y as ce,z as pe,B as Z,C as ge}from"./propertyInspectorInit.js";import{a as ve}from"./useSettings.js";import{D as fe}from"./DiagnosticsPanel.js";const ye=te({actions:{setGroups:y({groups:({event:t})=>t.type==="GROUPS_LOADED"?t.groups:[]}),setCurrentGroup:y({currentGroup:({event:t})=>t.type==="EDIT_GROUP"?t.group:null}),clearCurrentGroup:y({currentGroup:null,selectedLights:[]}),selectLight:y({selectedLights:({context:t,event:a})=>a.type==="SELECT_LIGHT"&&!t.selectedLights.includes(a.lightId)?[...t.selectedLights,a.lightId]:t.selectedLights}),deselectLight:y({selectedLights:({context:t,event:a})=>a.type==="DESELECT_LIGHT"?t.selectedLights.filter(l=>l!==a.lightId):t.selectedLights}),addOrUpdateGroup:y({groups:({context:t,event:a})=>{if(a.type==="GROUP_SAVED"){const l=t.groups.findIndex(o=>o.id===a.group.id);if(l>=0){const o=[...t.groups];return o[l]=a.group,o}else return[...t.groups,a.group]}return t.groups}}),removeGroup:y({groups:({context:t,event:a})=>a.type==="GROUP_DELETED"?t.groups.filter(l=>l.id!==a.groupId):t.groups}),setError:y({error:({event:t})=>t.type==="OPERATION_FAILED"?t.error:null}),clearError:y({error:null}),startLoading:y({isLoading:!0}),stopLoading:y({isLoading:!1})},actors:{loadGroups:z(async({input:t})=>{if(!f.isConnected)throw new Error("WebSocket not connected to Stream Deck");return new Promise((a,l)=>{const o=setTimeout(()=>{f.off("sendToPropertyInspector",i),l(new Error("Group loading timeout"))},1e4),i=d=>{d.payload?.event==="groupsReceived"&&(clearTimeout(o),f.off("sendToPropertyInspector",i),d.payload.error?l(new Error(d.payload.error)):a(d.payload.groups||[]))};f.on("sendToPropertyInspector",i),f.requestGroups()})}),saveGroup:z(async({input:t})=>{if(!f.isConnected)throw new Error("WebSocket not connected to Stream Deck");return new Promise((a,l)=>{const o=setTimeout(()=>{f.off("sendToPropertyInspector",i),l(new Error("Group save timeout"))},1e4),i=d=>{d.payload?.event==="groupSaved"&&(clearTimeout(o),f.off("sendToPropertyInspector",i),d.payload.error?l(new Error(d.payload.error)):a(d.payload.group))};f.on("sendToPropertyInspector",i),f.saveGroup({name:t.name,lightIds:t.selectedLights})})}),deleteGroup:z(async({input:t})=>{if(!f.isConnected)throw new Error("WebSocket not connected to Stream Deck");return new Promise((a,l)=>{const o=setTimeout(()=>{f.off("sendToPropertyInspector",i),l(new Error("Group delete timeout"))},1e4),i=d=>{d.payload?.event==="groupDeleted"&&(clearTimeout(o),f.off("sendToPropertyInspector",i),d.payload.error?l(new Error(d.payload.error)):a(d.payload.groupId))};f.on("sendToPropertyInspector",i),f.deleteGroup(t.groupId)})})}}).createMachine({id:"groupManagement",initial:"idle",context:({input:t})=>({groups:[],currentGroup:null,availableLights:[],selectedLights:[],error:null,isLoading:!1}),states:{idle:{on:{LOAD_GROUPS:{target:"loading"}}},loading:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"loadGroups",input:()=>({}),onDone:{target:"ready",actions:y({groups:({event:t})=>t.output})},onError:{target:"error",actions:y({error:({event:t})=>t.error?.message||"Unknown error"})}},on:{GROUPS_LOADED:{target:"ready",actions:"setGroups"},OPERATION_FAILED:{target:"error",actions:"setError"}}},ready:{on:{CREATE_GROUP:{target:"editing",actions:"clearCurrentGroup"},EDIT_GROUP:{target:"editing",actions:["setCurrentGroup",y({selectedLights:({event:t})=>t.type==="EDIT_GROUP"?t.group.lightIds||[]:[]})]},DELETE_GROUP:{target:"deleting"},LOAD_GROUPS:{target:"loading"}}},editing:{on:{SAVE_GROUP:{target:"saving"},CANCEL_EDIT:{target:"ready",actions:"clearCurrentGroup"},SELECT_LIGHT:{actions:"selectLight"},DESELECT_LIGHT:{actions:"deselectLight"}}},saving:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"saveGroup",input:({context:t,event:a,self:l})=>a.type==="SAVE_GROUP"?{name:a.name,selectedLights:a.selectedLights,groupId:t.currentGroup?.id}:{name:"",selectedLights:[]},onDone:{target:"ready",actions:[y({groups:({context:t,event:a})=>{const l=a.output,o=t.groups.findIndex(i=>i.id===l.id);if(o>=0){const i=[...t.groups];return i[o]=l,i}else return[...t.groups,l]}}),"clearCurrentGroup"]},onError:{target:"error",actions:y({error:({event:t})=>t.error?.message||"Unknown error"})}},on:{GROUP_SAVED:{target:"ready",actions:["addOrUpdateGroup","clearCurrentGroup"]},OPERATION_FAILED:{target:"error",actions:"setError"}}},deleting:{entry:["startLoading","clearError"],exit:"stopLoading",invoke:{src:"deleteGroup",input:({event:t,self:a})=>t.type==="DELETE_GROUP"?{groupId:t.groupId}:{groupId:""},onDone:{target:"ready",actions:y({groups:({context:t,event:a})=>t.groups.filter(l=>l.id!==a.output)})},onError:{target:"error",actions:y({error:({event:t})=>t.error?.message||"Unknown error"})}},on:{GROUP_DELETED:{target:"ready",actions:"removeGroup"},OPERATION_FAILED:{target:"error",actions:"setError"}}},error:{on:{LOAD_GROUPS:{target:"loading",actions:"clearError"},CREATE_GROUP:{target:"editing",actions:["clearError","clearCurrentGroup"]}}}}});function me(){const t=L(null),a=L("idle"),l=L([]),o=L(null),i=L([]),d=L([]),C=L(null),D=L(!1),x=c(()=>a.value==="idle"),M=c(()=>a.value==="loading"),H=c(()=>a.value==="ready"),b=c(()=>a.value==="editing"),h=c(()=>a.value==="saving"),F=c(()=>a.value==="deleting"),I=c(()=>a.value==="error"),P=c(()=>l.value.length>0),A=c(()=>b.value&&o.value===null),G=c(()=>b.value&&o.value!==null);j(()=>{t.value=oe(ye,{input:{}}),t.value.subscribe(v=>{a.value=v.value,l.value=v.context.groups,o.value=v.context.currentGroup,i.value=v.context.availableLights,d.value=v.context.selectedLights,C.value=v.context.error,D.value=v.context.isLoading}),t.value.start()}),ee(()=>{t.value&&t.value.stop()});const T=()=>{t.value&&t.value.send({type:"LOAD_GROUPS"})},w=()=>{t.value&&t.value.send({type:"CREATE_GROUP"})},R=v=>{t.value&&t.value.send({type:"EDIT_GROUP",group:v})},O=(v,s)=>{t.value&&t.value.send({type:"SAVE_GROUP",name:v,selectedLights:s})},K=v=>{t.value&&t.value.send({type:"DELETE_GROUP",groupId:v})},$=()=>{t.value&&t.value.send({type:"CANCEL_EDIT"})},U=v=>{t.value&&t.value.send({type:"SELECT_LIGHT",lightId:v})},V=v=>{t.value&&t.value.send({type:"DESELECT_LIGHT",lightId:v})},B=v=>{d.value.includes(v)?V(v):U(v)},q=v=>c(()=>d.value.includes(v));return{state:c(()=>a.value),groups:c(()=>l.value),currentGroup:c(()=>o.value),availableLights:c(()=>i.value),selectedLights:c(()=>d.value),error:c(()=>C.value),isLoading:c(()=>D.value),isIdle:x,isLoadingGroups:M,isReady:H,isEditing:b,isSaving:h,isDeleting:F,hasError:I,hasGroups:P,isCreatingNew:A,isEditingExisting:G,loadGroups:T,createGroup:w,editGroup:R,saveGroup:O,deleteGroup:K,cancelEdit:$,selectLight:U,deselectLight:V,toggleLightSelection:B,isLightSelected:q}}const he={class:"pi-view"},Ge={class:"config-section diagnostics-section"},Ee={key:0,class:"transport-health"},Le={class:"transport-label"},be={key:0},_e={class:"config-section","data-testid":"group-management-section"},Te={key:0,class:"form-group"},Se=["disabled"],Ce={key:1,class:"status-message status-loading"},Ie={key:2,class:"status-message status-error"},ke={key:3,class:"form-group"},De={class:"form-group"},Pe=["disabled"],we={value:"",disabled:""},Oe=["value"],Ae={class:"group-actions"},Re=["disabled"],Ue=["disabled"],Ve={key:0},Ne={key:1},xe=["disabled"],Me={key:0,class:"config-section","data-testid":"group-creation-form"},He={key:0,class:"status-message status-loading"},Fe={key:1},Ke={class:"form-group"},$e=["disabled"],Be={class:"form-group"},qe={key:0,class:"status-message status-loading"},ze={key:1,class:"status-message status-loading"},We={key:2,class:"status-message status-error"},Je={key:3,class:"light-selection"},Qe=["id","checked","onChange"],Xe=["for"],Ye={key:4,class:"status-message status-error"},Ze={class:"form-actions"},je=["disabled"],et=["disabled"],tt={class:"config-section","data-testid":"control-mode-section"},ot={class:"form-group"},st={key:0,class:"form-group"},rt={class:"range-value"},nt={key:1,class:"form-group"},at={key:2,class:"form-group"},lt={class:"range-value"},it=se({__name:"GroupControlView",setup(t){const a=re(),l=ne(),o=me(),i=ve(),d=ae(),C=L([]),D=L(null),x=()=>{f.requestTransportHealth()},M=()=>{f.requestTelemetrySnapshot()},H=()=>{f.resetTelemetry()},b=()=>{x(),M()},h=L(""),F=c(()=>o.isCreatingNew.value),I=c(()=>o.isEditingExisting.value),P=c(()=>o.selectedLights.value),A=c({get:()=>i.settings.apiKey||"",set:s=>i.updateSetting("apiKey",s||void 0)}),G=c({get:()=>i.settings.selectedGroupId||"",set:s=>{if(i.updateSetting("selectedGroupId",s||void 0),s){const e=o.groups.value.find(r=>r.id===s);e&&i.updateSetting("selectedGroupName",e.name)}else i.updateSetting("selectedGroupName",void 0)}}),T=c({get:()=>i.settings.controlMode||"toggle",set:s=>i.updateSetting("controlMode",s)}),w=c({get:()=>i.settings.brightnessValue||100,set:s=>i.updateSetting("brightnessValue",s)}),R=c({get:()=>i.settings.colorValue||"#ffffff",set:s=>i.updateSetting("colorValue",s)}),O=c({get:()=>i.settings.colorTempValue||6500,set:s=>i.updateSetting("colorTempValue",s)}),K=()=>{const s=o.groups.value.find(e=>e.id===G.value);s&&(o.editGroup(s),h.value=s.name)},$=()=>{G.value&&window.confirm("Are you sure you want to delete this group?")&&(o.deleteGroup(G.value),G.value="")},U=()=>{h.value&&P.value.length>0&&(o.saveGroup(h.value,P.value),h.value="")},V=()=>{o.cancelEdit(),h.value=""},B=()=>{o.createGroup(),h.value=""},q=s=>{o.toggleLightSelection(s)},v=s=>o.isLightSelected(s).value;return E(()=>a.isConnected.value,(s,e)=>{s&&!e&&(d.showSuccessToast("API Connected","Successfully connected to Govee API"),l.isIdle.value?l.fetchLights():l.refreshLights(),o.isIdle.value&&o.loadGroups(),b())}),E(()=>i.settings.apiKey,s=>{s&&!a.isConnected.value&&a.connect(s)}),E(()=>a.error.value,s=>{s&&d.showApiError({message:s},"API Connection Failed")}),E(()=>l.isReady.value,(s,e)=>{if(s&&!e&&l.hasLights.value){const r=l.lights.value.length;d.showSuccessToast("Lights Discovered",`Found ${r} light${r===1?"":"s"}`)}}),E(()=>l.error.value,s=>{s&&d.showApiError({message:s},"Light Discovery Failed")}),E(()=>o.isReady.value,(s,e)=>{if(s&&!e){const r=o.groups.value.length;d.showSuccessToast("Groups Loaded",r?`Loaded ${r} group${r===1?"":"s"}`:"No groups configured yet")}}),E(()=>o.error.value,s=>{s&&d.showApiError({message:s},"Group Operation Failed")}),E(()=>o.isSaving.value,(s,e)=>{!s&&e&&!o.hasError.value&&(d.showSuccessToast("Group Saved","Group changes saved successfully"),b())}),E(()=>o.isDeleting.value,(s,e)=>{!s&&e&&!o.hasError.value&&(d.showSuccessToast("Group Deleted","Group removed successfully"),b())}),E(()=>o.groups.value,s=>{if(G.value){const e=s.find(Q=>Q.id===G.value),r=e?.name||void 0;i.settings.selectedGroupName!==r&&i.updateSetting("selectedGroupName",r),e||(G.value="")}},{deep:!0}),E(()=>o.currentGroup.value,s=>{s?h.value=s.name:o.isEditing.value||(h.value="")}),E(()=>o.isEditing.value,s=>{s&&l.isIdle.value&&l.fetchLights()}),j(()=>{i.enableAutoSave(500),i.loadSettings(),i.settings.apiKey&&a.connect(i.settings.apiKey),a.isConnected.value&&(o.isIdle.value&&o.loadGroups(),b());const s=e=>{e.payload?.event==="transportHealth"&&(C.value=e.payload.transports??[]),e.payload?.event==="telemetrySnapshot"&&(D.value=e.payload.snapshot??null)};f.on("sendToPropertyInspector",s),ee(()=>{f.off("sendToPropertyInspector",s)})}),(s,e)=>(g(),p("div",he,[X(le,{modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=r=>A.value=r)},null,8,["modelValue"]),n("section",Ge,[e[10]||(e[10]=n("h2",null,"Connectivity Diagnostics",-1)),C.value.length?(g(),p("div",Ee,[n("ul",null,[(g(!0),p(W,null,J(C.value,r=>(g(),p("li",{key:r.kind},[n("span",Le,m(r.label),1),n("span",{class:ie(["transport-indicator",{healthy:r.isHealthy,unhealthy:!r.isHealthy}])},[_(m(r.isHealthy?"Available":"Unavailable")+" ",1),r.latencyMs!==void 0?(g(),p("span",be," â€¢ "+m(r.latencyMs)+" ms ",1)):S("",!0)],2)]))),128))])])):S("",!0),X(fe,{snapshot:D.value,onRefresh:b,onReset:H},null,8,["snapshot"])]),n("section",_e,[e[15]||(e[15]=n("h2",null,"Group Management",-1)),u(o).isIdle?(g(),p("div",Te,[n("button",{class:"btn btn-primary",disabled:!u(a).isConnected,onClick:e[1]||(e[1]=(...r)=>u(o).loadGroups&&u(o).loadGroups(...r))}," Load Groups ",8,Se),e[11]||(e[11]=n("small",{class:"help-text"}," Connect your API key first, then load your light groups ",-1))])):u(o).isLoadingGroups?(g(),p("div",Ce,[...e[12]||(e[12]=[n("span",{class:"status-icon"},"â³",-1),_(" Loading groups... ",-1)])])):u(o).hasError?(g(),p("div",Ie,[e[13]||(e[13]=n("span",{class:"status-icon"},"âŒ",-1)),_(" "+m(u(o).error)+" ",1),n("button",{class:"btn-link",onClick:e[2]||(e[2]=(...r)=>u(o).loadGroups&&u(o).loadGroups(...r))}," Retry ")])):u(o).isReady?(g(),p("div",ke,[n("div",De,[e[14]||(e[14]=n("label",{for:"groupSelect"},"Light Group",-1)),k(n("select",{id:"groupSelect","onUpdate:modelValue":e[3]||(e[3]=r=>G.value=r),class:"form-select",disabled:!u(o).hasGroups},[n("option",we,m(u(o).hasGroups?"Select a light group...":"No groups found"),1),(g(!0),p(W,null,J(u(o).groups.value,r=>(g(),p("option",{key:r.id,value:r.id},m(r.name)+" ("+m(r.lightIds?.length||0)+" lights) ",9,Oe))),128))],8,Pe),[[Y,G.value]])]),n("div",Ae,[n("button",{type:"button",class:"btn btn-secondary",disabled:!G.value||u(o).isLoading.value,onClick:K}," âœï¸ Edit ",8,Re),n("button",{type:"button",class:"btn btn-danger",disabled:!G.value||u(o).isLoading.value,onClick:$},[u(o).isDeleting?(g(),p("span",Ve,"Deleting...")):(g(),p("span",Ne,"ðŸ—‘ï¸ Delete"))],8,Ue),n("button",{type:"button",class:"btn btn-primary",disabled:u(o).isLoading.value,onClick:B}," + Create New Group ",8,xe)])])):S("",!0)]),F.value||I.value?(g(),p("section",Me,[n("h2",null,m(I.value?"Edit Group":"Create New Group"),1),u(o).isSaving?(g(),p("div",He,[e[16]||(e[16]=n("span",{class:"status-icon"},"â³",-1)),_(" "+m(I.value?"Updating group...":"Creating group..."),1)])):(g(),p("div",Fe,[n("div",Ke,[e[17]||(e[17]=n("label",{for:"groupName"},"Group Name",-1)),k(n("input",{id:"groupName","onUpdate:modelValue":e[4]||(e[4]=r=>h.value=r),type:"text",class:"form-input",placeholder:"Enter group name",disabled:u(o).isLoading.value},null,8,$e),[[N,h.value]])]),n("div",Be,[e[22]||(e[22]=n("label",null,"Select Lights",-1)),u(l).isIdle?(g(),p("div",qe,[...e[18]||(e[18]=[n("span",{class:"status-icon"},"â³",-1),_(" Loading available lights... ",-1)])])):u(l).isFetchingLights?(g(),p("div",ze,[...e[19]||(e[19]=[n("span",{class:"status-icon"},"â³",-1),_(" Discovering lights... ",-1)])])):u(l).hasError?(g(),p("div",We,[e[20]||(e[20]=n("span",{class:"status-icon"},"âŒ",-1)),_(" "+m(u(l).error)+" ",1),n("button",{class:"btn-link",onClick:e[5]||(e[5]=(...r)=>u(l).retryFetch&&u(l).retryFetch(...r))}," Retry ")])):u(l).isReady&&u(l).hasLights?(g(),p("div",Je,[(g(!0),p(W,null,J(u(l).lights.value,r=>(g(),p("div",{key:r.value,class:"light-checkbox"},[n("input",{id:`light-${r.value}`,checked:v(r.value),type:"checkbox",class:"checkbox",onChange:Q=>q(r.value)},null,40,Qe),n("label",{for:`light-${r.value}`,class:"checkbox-label"},m(r.label),9,Xe)]))),128))])):(g(),p("div",Ye,[...e[21]||(e[21]=[n("span",{class:"status-icon"},"â„¹ï¸",-1),_(" No lights available. Make sure your API key is connected and lights are discoverable. ",-1)])]))]),n("div",Ze,[n("button",{type:"button",class:"btn btn-secondary",disabled:u(o).isLoading.value,onClick:V}," Cancel ",8,je),n("button",{type:"button",class:"btn btn-primary",disabled:!h.value||P.value.length===0||u(o).isLoading.value,onClick:U},m(I.value?"Update Group":"Create Group"),9,et)])]))])):S("",!0),n("section",tt,[e[28]||(e[28]=n("h2",null,"Control Mode",-1)),n("div",ot,[e[24]||(e[24]=n("label",{for:"controlMode"},"Control Mode",-1)),k(n("select",{id:"controlMode","onUpdate:modelValue":e[6]||(e[6]=r=>T.value=r),class:"form-select"},[...e[23]||(e[23]=[ue('<option value="toggle" data-v-f63844f0>Toggle On/Off</option><option value="on" data-v-f63844f0>Turn On</option><option value="off" data-v-f63844f0>Turn Off</option><option value="brightness" data-v-f63844f0>Set Brightness</option><option value="color" data-v-f63844f0>Set Color</option><option value="colorTemp" data-v-f63844f0>Set Color Temperature</option>',6)])],512),[[Y,T.value]])]),T.value==="brightness"?(g(),p("div",st,[e[25]||(e[25]=n("label",{for:"brightness"},"Brightness (%)",-1)),k(n("input",{id:"brightness","onUpdate:modelValue":e[7]||(e[7]=r=>w.value=r),type:"range",min:"1",max:"100",class:"form-range"},null,512),[[N,w.value,void 0,{number:!0}]]),n("span",rt,m(w.value)+"%",1)])):S("",!0),T.value==="color"?(g(),p("div",nt,[e[26]||(e[26]=n("label",{for:"color"},"Color",-1)),k(n("input",{id:"color","onUpdate:modelValue":e[8]||(e[8]=r=>R.value=r),type:"color",class:"form-color"},null,512),[[N,R.value]])])):S("",!0),T.value==="colorTemp"?(g(),p("div",at,[e[27]||(e[27]=n("label",{for:"colorTemp"},"Color Temperature (K)",-1)),k(n("input",{id:"colorTemp","onUpdate:modelValue":e[9]||(e[9]=r=>O.value=r),type:"range",min:"2000",max:"9000",step:"100",class:"form-range"},null,512),[[N,O.value,void 0,{number:!0}]]),n("span",lt,m(O.value)+"K",1)])):S("",!0)])]))}}),ut=de(it,[["__scopeId","data-v-f63844f0"]]);ce();const dt=pe({render:()=>Z(ge,null,{default:()=>Z(ut)})});dt.mount("#app");
//# sourceMappingURL=group-control.js.map
